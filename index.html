<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penghitung Keuangan Otomatis</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #ff7e00; /* Orange color */
            --secondary-color: #e66f00;
            --success-color: #0a8754; /* Darker green for light mode */
            --danger-color: #c41e3a; /* Darker red for light mode */
            --dark-color: #2c3e50;
            --light-color: #f8f9fa;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --orange-light: #fff4e6;
            --orange-medium: #ffcc80;
            --orange-dark: #ff9800;
            --date-badge-bg: #fff4e6;
            --date-badge-color: #ff7e00;
            --date-badge-border: #ffcc80;
            --value-badge-bg: #fff4e6;
            --value-badge-color: #ff7e00;
            --value-badge-border: #ffcc80;
            
            /* Neon colors for dark mode */
            --neon-primary: #ffb74d;
            --neon-success: #00ff88;
            --neon-danger: #ff4757;
            --neon-warning: #ffa502;
            --neon-info: #70a1ff;
            --neon-dark: #a4b0be;
            --neon-white: #f1f2f6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fff4e6 0%, #ffe0b2 100%);
            min-height: 100vh;
            color: var(--dark-color);
            transition: var(--transition);
            overflow-x: hidden;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #1a1f2e 0%, #0f1320 100%);
            color: #e1e8f0;
            --date-badge-bg: #334155;
            --date-badge-color: #ffb74d;
            --date-badge-border: #475569;
            --value-badge-bg: #334155;
            --value-badge-color: #ffb74d;
            --value-badge-border: #475569;
        }
        
        .container-fluid {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2.5rem;
            position: relative;
            animation: fadeInDown 0.8s ease-out;
        }
        
        .header h1 {
            font-weight: 700;
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }
        
        body.dark-mode .header h1 {
            color: #ffb74d;
            text-shadow: 0 0 10px rgba(255, 183, 77, 0.7);
        }
        
        .header p {
            color: #6c757d;
            font-size: 1.1rem;
            max-width: 500px;
            margin: 0 auto;
        }
        
        body.dark-mode .header p {
            color: #a0aec0;
        }
        
        .dark-mode-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--primary-color);
            font-size: 1.2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            z-index: 10;
        }
        
        body.dark-mode .dark-mode-toggle {
            background: rgba(30, 41, 59, 0.9);
            color: #ffb74d;
            box-shadow: 0 0 15px rgba(255, 183, 77, 0.3);
        }
        
        .dark-mode-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        
        body.dark-mode .dark-mode-toggle:hover {
            box-shadow: 0 0 20px rgba(255, 183, 77, 0.5);
        }
        
        .card {
            border: none;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            background-color: white;
            overflow: hidden;
            transition: var(--transition);
            margin-bottom: 1.5rem;
            animation: fadeInUp 0.8s ease-out;
        }
        
        body.dark-mode .card {
            background-color: #1e2936;
            color: #e2e8f0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        body.dark-mode .card:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .card-header {
            background-color: transparent;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding: 1.25rem 1.5rem;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        body.dark-mode .card-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: #e2e8f0;
        }
        
        .card-header i {
            color: var(--primary-color);
            margin-right: 0.5rem;
        }
        
        body.dark-mode .card-header i {
            color: #ffb74d;
            text-shadow: 0 0 5px rgba(255, 183, 77, 0.5);
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #495057;
            font-size: 0.95rem;
        }
        
        body.dark-mode .form-label {
            color: #cbd5e0;
        }
        
        .form-control {
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: var(--transition);
            background-color: #f8fafc;
            color: #495057;
        }
        
        body.dark-mode .form-control {
            background-color: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(255, 126, 0, 0.15);
            background-color: #fff;
            color: #495057;
        }
        
        body.dark-mode .form-control:focus {
            background-color: #334155;
            box-shadow: 0 0 0 0.25rem rgba(255, 183, 77, 0.3);
            color: #e2e8f0;
        }
        
        /* Remove spinner from number inputs */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        .input-group-text {
            border-radius: 10px 0 0 10px;
            border: 1px solid #e2e8f0;
            background-color: #f1f5f9;
            color: #64748b;
        }
        
        body.dark-mode .input-group-text {
            background-color: #334155;
            border-color: #475569;
            color: #94a3b8;
        }
        
        .btn {
            border-radius: 10px;
            padding: 0.75rem 1.25rem;
            font-weight: 600;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .btn i {
            margin-right: 0.5rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 126, 0, 0.3);
        }
        
        body.dark-mode .btn-primary:hover {
            box-shadow: 0 4px 15px rgba(255, 183, 77, 0.4);
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #086a42;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(10, 135, 84, 0.3);
        }
        
        body.dark-mode .btn-success:hover {
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.4);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #a01729;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(196, 30, 58, 0.3);
        }
        
        body.dark-mode .btn-danger:hover {
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.4);
        }
        
        .btn-warning {
            background-color: var(--orange-dark);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e68900;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }
        
        body.dark-mode .btn-warning:hover {
            box-shadow: 0 4px 15px rgba(255, 165, 2, 0.4);
        }
        
        .btn-light {
            background-color: #f8fafc;
            color: var(--dark-color);
            border: 1px solid #e2e8f0;
        }
        
        body.dark-mode .btn-light {
            background-color: #334155;
            color: #e2e8f0;
            border-color: #475569;
        }
        
        .btn-light:hover {
            background-color: #e2e8f0;
            transform: translateY(-2px);
        }
        
        body.dark-mode .btn-light:hover {
            background-color: #475569;
        }
        
        .btn-add {
            background-color: rgba(255, 126, 0, 0.1);
            color: var(--primary-color);
            width: 100%;
            margin-top: 1rem;
        }
        
        body.dark-mode .btn-add {
            background-color: rgba(255, 183, 77, 0.1);
            color: #ffb74d;
        }
        
        .btn-add:hover {
            background-color: rgba(255, 126, 0, 0.2);
        }
        
        body.dark-mode .btn-add:hover {
            background-color: rgba(255, 183, 77, 0.2);
        }
        
        .btn-remove {
            background-color: rgba(255, 62, 113, 0.1);
            color: var(--danger-color);
            padding: 0.5rem;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            margin-left: 0.5rem;
        }
        
        body.dark-mode .btn-remove {
            background-color: rgba(255, 62, 113, 0.2);
            color: #ff6b91;
        }
        
        .btn-remove:hover {
            background-color: rgba(255, 62, 113, 0.2);
        }
        
        body.dark-mode .btn-remove:hover {
            background-color: rgba(255, 62, 113, 0.3);
        }
        
        .nav-tabs {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
        }
        
        body.dark-mode .nav-tabs {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .nav-tabs .nav-link {
            border: none;
            border-radius: 10px 10px 0 0;
            color: #6c757d;
            font-weight: 500;
            padding: 0.75rem 1.25rem;
            transition: var(--transition);
        }
        
        body.dark-mode .nav-tabs .nav-link {
            color: #94a3b8;
        }
        
        .nav-tabs .nav-link:hover {
            color: var(--primary-color);
            background-color: rgba(255, 126, 0, 0.05);
        }
        
        body.dark-mode .nav-tabs .nav-link:hover {
            color: #ffb74d;
            background-color: rgba(255, 183, 77, 0.05);
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: transparent;
            border-bottom: 2px solid var(--primary-color);
        }
        
        body.dark-mode .nav-tabs .nav-link.active {
            color: #ffb74d;
        }
        
        .tax-item, .operational-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: #f8fafc;
            border-radius: 12px;
            transition: var(--transition);
        }
        
        body.dark-mode .tax-item, 
        body.dark-mode .operational-item {
            background-color: #334155;
        }
        
        .tax-item:hover, .operational-item:hover {
            background-color: #f1f5f9;
        }
        
        body.dark-mode .tax-item:hover, 
        body.dark-mode .operational-item:hover {
            background-color: #475569;
        }
        
        .tax-item input, .operational-item input {
            margin-right: 0.75rem;
        }
        
        .tax-item input.form-control, .operational-item input.form-control {
            background-color: white;
            color: #495057;
        }
        
        body.dark-mode .tax-item input.form-control, 
        body.dark-mode .operational-item input.form-control {
            background-color: #1e2936;
            color: #e2e8f0;
        }
        
        /* Perbaikan untuk lebar input nama pajak */
        .tax-item .tax-name {
            width: 60%; /* Lebar lebih panjang untuk nama pajak */
            flex-shrink: 0;
        }
        
        /* Perbaikan untuk lebar input persentase */
        .tax-percentage-container {
            position: relative;
            width: 100px; /* Lebar lebih lebar untuk persentase */
            flex-shrink: 0;
        }
        
        .tax-percentage-input {
            padding-right: 25px !important;
        }
        
        .tax-percentage-suffix {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 0.9rem;
            pointer-events: none;
        }
        
        body.dark-mode .tax-percentage-suffix {
            color: #94a3b8;
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.3);
        }
        
        /* Perbaikan untuk lebar input nilai */
        .tax-value-container {
            position: relative;
            flex: 1; /* Mengambil sisa ruang yang tersedia */
            min-width: 140px; /* Lebar minimum */
        }
        
        .tax-value-prefix {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 0.9rem;
            pointer-events: none;
        }
        
        body.dark-mode .tax-value-prefix {
            color: #94a3b8;
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.3);
        }
        
        .tax-value-input {
            padding-left: 30px !important;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.08);
        }
        
        body.dark-mode .result-item {
            border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            color: #64748b;
            font-weight: 500;
        }
        
        body.dark-mode .result-label {
            color: #94a3b8;
        }
        
        .result-value {
            font-weight: 600;
            position: relative;
            display: inline-block;
        }
        
        .result-value.positive {
            color: var(--success-color);
        }
        
        body.dark-mode .result-value.positive {
            color: var(--neon-success);
            text-shadow: 0 0 5px rgba(0, 255, 136, 0.5);
        }
        
        .result-value.negative {
            color: var(--danger-color);
        }
        
        body.dark-mode .result-value.negative {
            color: var(--neon-danger);
            text-shadow: 0 0 5px rgba(255, 71, 87, 0.5);
        }
        
        .result-value.neutral {
            color: var(--dark-color);
        }
        
        body.dark-mode .result-value.neutral {
            color: var(--neon-white);
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }
        
        /* Shapes for values */
        .value-shape {
            position: relative;
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .value-shape.positive {
            background-color: rgba(10, 135, 84, 0.1);
            color: var(--success-color);
        }
        
        body.dark-mode .value-shape.positive {
            background-color: rgba(0, 255, 136, 0.1);
            color: var(--neon-success);
            text-shadow: 0 0 5px rgba(0, 255, 136, 0.5);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
        }
        
        .value-shape.negative {
            background-color: rgba(196, 30, 58, 0.1);
            color: var(--danger-color);
        }
        
        body.dark-mode .value-shape.negative {
            background-color: rgba(255, 71, 87, 0.1);
            color: var(--neon-danger);
            text-shadow: 0 0 5px rgba(255, 71, 87, 0.5);
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.2);
        }
        
        .value-shape.neutral {
            background-color: rgba(44, 62, 80, 0.1);
            color: var(--dark-color);
        }
        
        body.dark-mode .value-shape.neutral {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--neon-white);
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }
        
        .highlight-box {
            background-color: rgba(255, 126, 0, 0.08);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            border-left: 3px solid var(--primary-color);
        }
        
        body.dark-mode .highlight-box {
            background-color: rgba(255, 183, 77, 0.08);
            border-left: 3px solid var(--neon-primary);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.1);
        }
        
        .final-result {
            background: linear-gradient(135deg, rgba(10, 135, 84, 0.1) 0%, rgba(10, 135, 84, 0.05) 100%);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border-left: 4px solid var(--success-color);
            transition: var(--transition);
        }
        
        body.dark-mode .final-result {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15) 0%, rgba(0, 255, 136, 0.08) 100%);
            border-left: 4px solid var(--neon-success);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.1);
        }
        
        .final-result:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .final-result:hover {
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.2);
        }
        
        .final-result .result-item:last-child {
            font-size: 1.2rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 2px solid rgba(0, 0, 0, 0.06);
        }
        
        body.dark-mode .final-result .result-item:last-child {
            border-top: 2px solid rgba(255, 255, 255, 0.06);
        }
        
        .calculation-step {
            margin-bottom: 1.5rem;
            padding-left: 2.5rem;
            position: relative;
        }
        
        .step-number {
            position: absolute;
            left: 0;
            top: 0;
            width: 32px;
            height: 32px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        body.dark-mode .step-number {
            background-color: var(--neon-primary);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.5);
        }
        
        .step-content h6 {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }
        
        body.dark-mode .step-content h6 {
            color: #e2e8f0;
        }
        
        .formula {
            font-family: 'Courier New', monospace;
            background-color: #f1f5f9;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin: 0.5rem 0;
            font-size: 0.9rem;
            color: #475569;
        }
        
        body.dark-mode .formula {
            background-color: #334155;
            color: #cbd5e0;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #64748b;
        }
        
        body.dark-mode .empty-state {
            color: #94a3b8;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #cbd5e0;
            opacity: 0.7;
        }
        
        body.dark-mode .empty-state i {
            color: #475569;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        .action-buttons .btn {
            flex: 1;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: var(--transition);
            max-width: 350px;
            display: flex;
            align-items: center;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification i {
            margin-right: 0.75rem;
            font-size: 1.2rem;
        }
        
        .notification.success {
            background: linear-gradient(135deg, var(--success-color), #086a42);
        }
        
        body.dark-mode .notification.success {
            background: linear-gradient(135deg, var(--neon-success), #00cc6a);
            box-shadow: 0 10px 25px rgba(0, 255, 136, 0.3);
        }
        
        .notification.error {
            background: linear-gradient(135deg, var(--danger-color), #a01729);
        }
        
        body.dark-mode .notification.error {
            background: linear-gradient(135deg, var(--neon-danger), #cc0030);
            box-shadow: 0 10px 25px rgba(255, 71, 87, 0.3);
        }
        
        .notification.info {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }
        
        body.dark-mode .notification.info {
            background: linear-gradient(135deg, var(--neon-primary), #e66f00);
            box-shadow: 0 10px 25px rgba(255, 183, 77, 0.3);
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        body.dark-mode .notification.warning {
            background: linear-gradient(135deg, var(--neon-warning), #cc8400);
            box-shadow: 0 10px 25px rgba(255, 165, 2, 0.3);
        }
        
        .history-container {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .history-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .history-container::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        
        body.dark-mode .history-container::-webkit-scrollbar-track {
            background: #334155;
        }
        
        .history-container::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 10px;
        }
        
        body.dark-mode .history-container::-webkit-scrollbar-thumb {
            background: #475569;
        }
        
        .history-item {
            background-color: #f8fafc;
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            border-left: 4px solid var(--primary-color);
            position: relative;
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }
        
        body.dark-mode .history-item {
            background-color: #334155;
            border-left: 4px solid var(--neon-primary);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.1);
        }
        
        .history-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        
        body.dark-mode .history-item::before {
            background: linear-gradient(to bottom, var(--neon-primary), #e66f00);
        }
        
        .history-item:hover::before {
            transform: scaleY(1);
        }
        
        .history-item:hover {
            background-color: #fff4e6;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .history-item:hover {
            background-color: #475569;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }
        
        .history-date-badge {
            background-color: var(--date-badge-bg);
            color: var(--date-badge-color);
            border: 1px solid var(--date-badge-border);
            border-radius: 30px;
            padding: 0.35rem 0.85rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }
        
        body.dark-mode .history-date-badge {
            background-color: var(--date-badge-bg);
            color: var(--date-badge-color);
            border: 1px solid var(--date-badge-border);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.2);
        }
        
        .history-date-badge i {
            margin-right: 0.35rem;
            font-size: 0.9rem;
        }
        
        body.dark-mode .history-date-badge i {
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.5);
        }
        
        .history-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .product-info {
            flex: 1;
        }
        
        .product-name {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 0.35rem;
            color: var(--dark-color);
            transition: var(--transition);
            letter-spacing: -0.3px;
        }
        
        body.dark-mode .product-name {
            color: #e2e8f0;
        }
        
        .history-item:hover .product-name {
            color: var(--primary-color);
        }
        
        body.dark-mode .history-item:hover .product-name {
            color: var(--neon-primary);
            text-shadow: 0 0 5px rgba(255, 183, 77, 0.5);
        }
        
        .product-brand {
            font-size: 0.95rem;
            color: #64748b;
            display: flex;
            align-items: center;
        }
        
        body.dark-mode .product-brand {
            color: #94a3b8;
        }
        
        .product-brand i {
            margin-right: 0.35rem;
            font-size: 0.85rem;
        }
        
        .history-profit {
            text-align: right;
            margin-left: 1rem;
        }
        
        .history-profit-label {
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 0.25rem;
        }
        
        body.dark-mode .history-profit-label {
            color: #94a3b8;
        }
        
        .history-net-profit {
            font-weight: 700;
            font-size: 1.15rem;
            padding: 0.35rem 0.75rem;
            border-radius: 8px;
            display: inline-block;
            transition: var(--transition);
        }
        
        .history-actions {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .history-item:hover .history-actions {
            opacity: 1;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1rem;
        }
        
        .search-container {
            position: relative;
            margin-bottom: 1rem;
        }
        
        .search-input {
            padding-left: 40px !important;
            border-radius: 30px;
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
            transition: var(--transition);
            color: #495057;
        }
        
        body.dark-mode .search-input {
            background-color: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }
        
        .search-input:focus {
            background-color: white;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(255, 126, 0, 0.15);
            color: #495057;
        }
        
        body.dark-mode .search-input:focus {
            background-color: #334155;
            box-shadow: 0 0 0 0.25rem rgba(255, 183, 77, 0.3);
            color: #e2e8f0;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 1.1rem;
        }
        
        body.dark-mode .search-icon {
            color: #94a3b8;
        }
        
        .filter-container {
            margin-bottom: 1.5rem;
        }
        
        .filter-select {
            width: 100%;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            transition: var(--transition);
            color: #495057;
        }
        
        body.dark-mode .filter-select {
            background-color: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }
        
        .filter-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(255, 126, 0, 0.15);
            background-color: white;
            color: #495057;
        }
        
        body.dark-mode .filter-select:focus {
            background-color: #334155;
            box-shadow: 0 0 0 0.25rem rgba(255, 183, 77, 0.3);
            color: #e2e8f0;
        }
        
        .deleted-history-item {
            background-color: #fff2f0;
            border-left-color: var(--danger-color);
        }
        
        body.dark-mode .deleted-history-item {
            background-color: rgba(255, 62, 113, 0.1);
            border-left-color: var(--neon-danger);
        }
        
        .restore-btn {
            background-color: rgba(255, 126, 0, 0.1);
            color: var(--primary-color);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }
        
        body.dark-mode .restore-btn {
            background-color: rgba(255, 183, 77, 0.1);
            color: var(--neon-primary);
        }
        
        .restore-btn:hover {
            background-color: rgba(255, 126, 0, 0.2);
        }
        
        body.dark-mode .restore-btn:hover {
            background-color: rgba(255, 183, 77, 0.2);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.3);
        }
        
        .permanent-delete-btn {
            background-color: rgba(255, 62, 113, 0.1);
            color: var(--danger-color);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            margin-left: 0.5rem;
        }
        
        body.dark-mode .permanent-delete-btn {
            background-color: rgba(255, 71, 87, 0.1);
            color: var(--neon-danger);
        }
        
        .permanent-delete-btn:hover {
            background-color: rgba(255, 62, 113, 0.2);
        }
        
        body.dark-mode .permanent-delete-btn:hover {
            background-color: rgba(255, 71, 87, 0.2);
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.3);
        }
        
        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 0.5rem;
        }
        
        .legend-value {
            font-weight: 600;
            margin-left: 0.25rem;
        }
        
        .search-section {
            background-color: #fff9f5;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid #ffe0b2;
        }
        
        body.dark-mode .search-section {
            background-color: #334155;
            border-color: #475569;
        }
        
        .search-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--primary-color);
        }
        
        body.dark-mode .search-title {
            color: var(--neon-primary);
            text-shadow: 0 0 5px rgba(255, 183, 77, 0.5);
        }
        
        .search-row {
            display: flex;
            gap: 1rem;
        }
        
        .search-col {
            flex: 1;
        }
        
        .date-filter-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .date-filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
            color: #64748b;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        body.dark-mode .date-filter-btn {
            border-color: #475569;
            background-color: #334155;
            color: #94a3b8;
        }
        
        .date-filter-btn:hover {
            background-color: #f1f5f9;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        body.dark-mode .date-filter-btn:hover {
            background-color: #475569;
            color: var(--neon-primary);
        }
        
        .date-filter-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        body.dark-mode .date-filter-btn.active {
            background-color: var(--neon-primary);
            border-color: var(--neon-primary);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.3);
        }
        
        .profit-filter-container {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .profit-filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid #e2e8f0;
            background-color: #f8fafc;
            color: #64748b;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        body.dark-mode .profit-filter-btn {
            border-color: #475569;
            background-color: #334155;
            color: #94a3b8;
        }
        
        .profit-filter-btn:hover {
            background-color: #f1f5f9;
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        body.dark-mode .profit-filter-btn:hover {
            background-color: #475569;
            color: var(--neon-primary);
        }
        
        .profit-filter-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        body.dark-mode .profit-filter-btn.active {
            background-color: var(--neon-primary);
            border-color: var(--neon-primary);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.3);
        }
        
        .print-selection-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background-color: #f8fafc;
            border-radius: 12px;
        }
        
        body.dark-mode .print-selection-container {
            background-color: #334155;
        }
        
        .print-selection-title {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        body.dark-mode .print-selection-title {
            color: #e2e8f0;
        }
        
        .print-history-item {
            background-color: #f8fafc;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            border-left: 4px solid var(--primary-color);
        }
        
        body.dark-mode .print-history-item {
            background-color: #334155;
            border-left: 4px solid var(--neon-primary);
        }
        
        .print-history-item:hover {
            background-color: #fff4e6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        body.dark-mode .print-history-item:hover {
            background-color: #475569;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .print-checkbox {
            margin-right: 1rem;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .print-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            justify-content: center;
        }
        
        .visual-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        @media (max-width: 992px) {
            .visual-container {
                grid-template-columns: 1fr;
            }
        }
        
        .countdown-warning {
            background-color: rgba(255, 126, 0, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 3px solid var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: pulse 2s infinite;
        }
        
        body.dark-mode .countdown-warning {
            background-color: rgba(255, 183, 77, 0.1);
            border-left: 3px solid var(--neon-primary);
            box-shadow: 0 0 15px rgba(255, 183, 77, 0.2);
        }
        
        .countdown-text {
            font-weight: 500;
            color: var(--primary-color);
        }
        
        body.dark-mode .countdown-text {
            color: var(--neon-primary);
            text-shadow: 0 0 5px rgba(255, 183, 77, 0.5);
        }
        
        .countdown-timer {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
            padding: 0.25rem 0.75rem;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            min-width: 60px;
            text-align: center;
        }
        
        body.dark-mode .countdown-timer {
            background-color: rgba(30, 41, 59, 0.7);
            color: var(--neon-primary);
            text-shadow: 0 0 5px rgba(255, 183, 77, 0.5);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.3);
        }
        
        .countdown-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .countdown-btn {
            background-color: rgba(255, 126, 0, 0.1);
            color: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        body.dark-mode .countdown-btn {
            background-color: rgba(255, 183, 77, 0.1);
            color: var(--neon-primary);
        }
        
        .countdown-btn:hover {
            background-color: rgba(255, 126, 0, 0.2);
        }
        
        body.dark-mode .countdown-btn:hover {
            background-color: rgba(255, 183, 77, 0.2);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.3);
        }
        
        .edit-history-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1050;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .edit-history-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .edit-history-content {
            background-color: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .edit-history-modal.show .edit-history-content {
            transform: scale(1);
        }
        
        body.dark-mode .edit-history-content {
            background-color: #1e2936;
            color: #e2e8f0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .edit-history-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        body.dark-mode .edit-history-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .edit-history-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 0;
        }
        
        body.dark-mode .edit-history-title {
            color: var(--neon-primary);
            text-shadow: 0 0 5px rgba(255, 183, 77, 0.5);
        }
        
        .edit-history-body {
            padding: 1.5rem;
        }
        
        .edit-history-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        body.dark-mode .edit-history-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .history-date-shape {
            background-color: var(--date-badge-bg);
            color: var(--date-badge-color);
            border: 1px solid var(--date-badge-border);
            border-radius: 30px;
            padding: 0.35rem 0.85rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            margin-top: 0.5rem;
        }
        
        body.dark-mode .history-date-shape {
            background-color: var(--date-badge-bg);
            color: var(--date-badge-color);
            border: 1px solid var(--date-badge-border);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.2);
        }
        
        .history-date-shape i {
            margin-right: 0.35rem;
            font-size: 0.9rem;
        }
        
        body.dark-mode .history-date-shape i {
            text-shadow: 0 0 3px rgba(255, 255, 255, 0.5);
        }
        
        .print-history-item:hover .history-date-shape {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        body.dark-mode .print-history-item:hover .history-date-shape {
            background-color: var(--neon-primary);
            color: white;
            border-color: var(--neon-primary);
            box-shadow: 0 0 10px rgba(255, 183, 77, 0.5);
        }
        
        /* Tax input improvements */
        .tax-percentage-input, .tax-value-input {
            font-weight: 600 !important;
            color: var(--dark-color) !important;
            background-color: #fff !important;
            border: 1px solid #ffcc80 !important;
            box-shadow: 0 0 0 2px rgba(255, 126, 0, 0.1) !important;
        }
        
        body.dark-mode .tax-percentage-input, 
        body.dark-mode .tax-value-input {
            color: #e2e8f0 !important;
            background-color: #1e2936 !important;
            border: 1px solid #ffb74d !important;
            box-shadow: 0 0 0 2px rgba(255, 183, 77, 0.2) !important;
        }
        
        /* Report summary styles */
        .report-summary {
            background: linear-gradient(135deg, rgba(255, 126, 0, 0.1) 0%, rgba(255, 126, 0, 0.05) 100%);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border-left: 4px solid var(--primary-color);
        }
        
        body.dark-mode .report-summary {
            background: linear-gradient(135deg, rgba(255, 183, 77, 0.15) 0%, rgba(255, 183, 77, 0.08) 100%);
            border-left: 4px solid var(--neon-primary);
            box-shadow: 0 0 15px rgba(255, 183, 77, 0.1);
        }
        
        .report-summary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .report-summary:hover {
            box-shadow: 0 8px 25px rgba(255, 183, 77, 0.2);
        }
        
        .report-title {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }
        
        body.dark-mode .report-title {
            color: var(--neon-primary);
            text-shadow: 0 0 5px rgba(255, 183, 77, 0.5);
        }
        
        .report-title i {
            margin-right: 0.5rem;
        }
        
        .report-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.08);
        }
        
        body.dark-mode .report-row {
            border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
        }
        
        .report-row:last-child {
            border-bottom: none;
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 2px solid rgba(0, 0, 0, 0.06);
        }
        
        body.dark-mode .report-row:last-child {
            border-top: 2px solid rgba(255, 255, 255, 0.06);
        }
        
        .report-label {
            color: #64748b;
            font-weight: 500;
        }
        
        body.dark-mode .report-label {
            color: #94a3b8;
        }
        
        .report-value {
            font-weight: 600;
        }
        
        /* Orange button styles */
        .btn-orange {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-orange:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 126, 0, 0.3);
        }
        
        body.dark-mode .btn-orange:hover {
            box-shadow: 0 4px 15px rgba(255, 183, 77, 0.4);
        }
        
        /* Responsive table styles */
        .responsive-table {
            width: 100%;
            margin-bottom: 1rem;
            background-color: transparent;
        }
        
        .responsive-table thead th {
            vertical-align: bottom;
            border-bottom: 2px solid #dee2e6;
            color: #495057;
            font-weight: 600;
        }
        
        body.dark-mode .responsive-table thead th {
            color: #cbd5e0;
            border-bottom: 2px solid #475569;
        }
        
        .responsive-table tbody tr {
            transition: all 0.2s ease;
        }
        
        .responsive-table tbody tr:hover {
            background-color: rgba(255, 126, 0, 0.05);
        }
        
        body.dark-mode .responsive-table tbody tr:hover {
            background-color: rgba(255, 183, 77, 0.05);
        }
        
        .responsive-table td, .responsive-table th {
            padding: 0.75rem;
            vertical-align: middle;
            border-top: 1px solid #dee2e6;
        }
        
        body.dark-mode .responsive-table td, 
        body.dark-mode .responsive-table th {
            border-top: 1px solid #475569;
        }
        
        .responsive-print-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .responsive-print-table thead {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        body.dark-mode .responsive-print-table thead {
            background: linear-gradient(135deg, var(--neon-primary), #e66f00);
        }
        
        .responsive-print-table th, .responsive-print-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }
        
        body.dark-mode .responsive-print-table th, 
        body.dark-mode .responsive-print-table td {
            border-bottom: 1px solid #475569;
        }
        
        .responsive-print-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        body.dark-mode .responsive-print-table tbody tr:nth-child(even) {
            background-color: #334155;
        }
        
        .responsive-print-table tbody tr:hover {
            background-color: #fff4e6;
        }
        
        body.dark-mode .responsive-print-table tbody tr:hover {
            background-color: #475569;
        }
        
        /* Company Profile Styles */
        .company-logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .company-logo-preview {
            width: 150px;
            height: 150px;
            border: 2px dashed #e2e8f0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            overflow: hidden;
            background-color: #f8fafc;
        }
        
        body.dark-mode .company-logo-preview {
            border-color: #475569;
            background-color: #334155;
        }
        
        .company-logo-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .company-logo-placeholder {
            color: #64748b;
            text-align: center;
        }
        
        body.dark-mode .company-logo-placeholder {
            color: #94a3b8;
        }
        
        .company-logo-placeholder i {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }
        
        .social-media-inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .social-media-input {
            flex: 1;
            min-width: 200px;
        }
        
        .contact-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        @media (max-width: 768px) {
            .contact-inputs {
                grid-template-columns: 1fr;
            }
        }
        
        .preview-company-profile {
            background-color: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border: 1px solid #e2e8f0;
        }
        
        body.dark-mode .preview-company-profile {
            background-color: #334155;
            border-color: #475569;
        }
        
        .preview-company-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .preview-company-logo {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            margin-right: 1rem;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        body.dark-mode .preview-company-logo {
            background-color: #1e2936;
        }
        
        .preview-company-logo img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .preview-company-logo i {
            font-size: 2rem;
            color: #e2e8f0;
        }
        
        .preview-company-info h5 {
            margin: 0 0 0.25rem;
            color: var(--primary-color);
        }
        
        body.dark-mode .preview-company-info h5 {
            color: var(--neon-primary);
            text-shadow: 0 0 5px rgba(255, 183, 77, 0.5);
        }
        
        .preview-company-info p {
            margin: 0;
            color: #64748b;
            font-size: 0.9rem;
        }
        
        body.dark-mode .preview-company-info p {
            color: #94a3b8;
        }
        
        .preview-company-details {
            margin-top: 1rem;
        }
        
        .preview-company-detail {
            display: flex;
            margin-bottom: 0.5rem;
        }
        
        .preview-company-detail i {
            width: 20px;
            color: var(--primary-color);
            margin-right: 0.5rem;
        }
        
        body.dark-mode .preview-company-detail i {
            color: var(--neon-primary);
            text-shadow: 0 0 5px rgba(255, 183, 77, 0.5);
        }
        
        .preview-company-detail span {
            color: #495057;
        }
        
        body.dark-mode .preview-company-detail span {
            color: #cbd5e0;
        }
        
        .preview-social-media {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .preview-social-media-item {
            display: flex;
            align-items: center;
            background-color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #495057;
        }
        
        body.dark-mode .preview-social-media-item {
            background-color: #1e2936;
            color: #cbd5e0;
        }
        
        .preview-social-media-item i {
            margin-right: 0.25rem;
            color: var(--primary-color);
        }
        
        body.dark-mode .preview-social-media-item i {
            color: var(--neon-primary);
            text-shadow: 0 0 5px rgba(255, 183, 77, 0.5);
        }
        
        /* Animated date badge styles */
        .animated-date-badge {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 30px;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            box-shadow: 0 4px 10px rgba(255, 126, 0, 0.3);
            position: relative;
            overflow: hidden;
            z-index: 1;
            animation: float 3s ease-in-out infinite;
        }
        
        body.dark-mode .animated-date-badge {
            background: linear-gradient(135deg, var(--neon-primary), #e66f00);
            box-shadow: 0 4px 15px rgba(255, 183, 77, 0.5);
        }
        
        .animated-date-badge::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0.1)
            );
            transform: rotate(45deg);
            z-index: -1;
            animation: shine 3s infinite;
        }
        
        .animated-date-badge i {
            margin-right: 0.5rem;
            font-size: 1rem;
            animation: pulse-icon 2s infinite;
        }
        
        body.dark-mode .animated-date-badge i {
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }
        
        /* Cute table styles */
        .cute-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        body.dark-mode .cute-table {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .cute-table thead {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        body.dark-mode .cute-table thead {
            background: linear-gradient(135deg, var(--neon-primary), #e66f00);
        }
        
        .cute-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: relative;
        }
        
        .cute-table th:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 20%;
            height: 60%;
            width: 1px;
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .cute-table tbody tr {
            transition: all 0.3s ease;
        }
        
        .cute-table tbody tr:nth-child(even) {
            background-color: #fff9f5;
        }
        
        body.dark-mode .cute-table tbody tr:nth-child(even) {
            background-color: #334155;
        }
        
        .cute-table tbody tr:nth-child(odd) {
            background-color: white;
        }
        
        body.dark-mode .cute-table tbody tr:nth-child(odd) {
            background-color: #1e2936;
        }
        
        .cute-table tbody tr:hover {
            background-color: #fff4e6;
            transform: scale(1.01);
            box-shadow: 0 3px 10px rgba(255, 126, 0, 0.1);
        }
        
        body.dark-mode .cute-table tbody tr:hover {
            background-color: #475569;
            box-shadow: 0 3px 10px rgba(255, 183, 77, 0.2);
        }
        
        .cute-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        body.dark-mode .cute-table td {
            border-bottom: 1px solid #475569;
        }
        
        .cute-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .cute-table .value-shape {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .cute-table .value-shape:hover {
            transform: scale(1.05);
        }
        
        /* Cute tax table styles */
        .cute-tax-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        body.dark-mode .cute-tax-table {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .cute-tax-table thead {
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
        }
        
        body.dark-mode .cute-tax-table thead {
            background: linear-gradient(135deg, var(--neon-info), #3a0ca3);
        }
        
        .cute-tax-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: relative;
        }
        
        .cute-tax-table th:first-child {
            width: 60%; /* Lebih lebar untuk nama pajak */
        }
        
        .cute-tax-table th:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 20%;
            height: 60%;
            width: 1px;
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .cute-tax-table tbody tr {
            transition: all 0.3s ease;
        }
        
        .cute-tax-table tbody tr:nth-child(even) {
            background-color: #f0f4ff;
        }
        
        body.dark-mode .cute-tax-table tbody tr:nth-child(even) {
            background-color: #334155;
        }
        
        .cute-tax-table tbody tr:nth-child(odd) {
            background-color: white;
        }
        
        body.dark-mode .cute-tax-table tbody tr:nth-child(odd) {
            background-color: #1e2936;
        }
        
        .cute-tax-table tbody tr:hover {
            background-color: #e6f0ff;
            transform: scale(1.01);
            box-shadow: 0 3px 10px rgba(67, 97, 238, 0.1);
        }
        
        body.dark-mode .cute-tax-table tbody tr:hover {
            background-color: #475569;
            box-shadow: 0 3px 10px rgba(112, 161, 255, 0.2);
        }
        
        .cute-tax-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        body.dark-mode .cute-tax-table td {
            border-bottom: 1px solid #475569;
        }
        
        .cute-tax-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .cute-tax-table .value-shape {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .cute-tax-table .value-shape:hover {
            transform: scale(1.05);
        }
        
        /* Single product table styles for print */
        .single-product-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        body.dark-mode .single-product-table {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .single-product-table thead {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        body.dark-mode .single-product-table thead {
            background: linear-gradient(135deg, var(--neon-primary), #e66f00);
        }
        
        .single-product-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: relative;
        }
        
        .single-product-table th:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 20%;
            height: 60%;
            width: 1px;
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .single-product-table tbody tr {
            transition: all 0.3s ease;
        }
        
        .single-product-table tbody tr:nth-child(even) {
            background-color: #fff9f5;
        }
        
        body.dark-mode .single-product-table tbody tr:nth-child(even) {
            background-color: #334155;
        }
        
        .single-product-table tbody tr:nth-child(odd) {
            background-color: white;
        }
        
        body.dark-mode .single-product-table tbody tr:nth-child(odd) {
            background-color: #1e2936;
        }
        
        .single-product-table tbody tr:hover {
            background-color: #fff4e6;
            transform: scale(1.01);
            box-shadow: 0 3px 10px rgba(255, 126, 0, 0.1);
        }
        
        body.dark-mode .single-product-table tbody tr:hover {
            background-color: #475569;
            box-shadow: 0 3px 10px rgba(255, 183, 77, 0.2);
        }
        
        .single-product-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        body.dark-mode .single-product-table td {
            border-bottom: 1px solid #475569;
        }
        
        .single-product-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .single-product-table .value-shape {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .single-product-table .value-shape:hover {
            transform: scale(1.05);
        }
        
        /* Ensure all icons are orange in light mode and bright orange in dark mode */
        i {
            color: var(--primary-color);
        }
        
        body.dark-mode i {
            color: var(--neon-primary);
        }
        
        /* Ensure all text is visible in dark mode */
        body.dark-mode p,
        body.dark-mode span,
        body.dark-mode div,
        body.dark-mode h1,
        body.dark-mode h2,
        body.dark-mode h3,
        body.dark-mode h4,
        body.dark-mode h5,
        body.dark-mode h6,
        body.dark-mode small,
        body.dark-mode label,
        body.dark-mode .text-muted,
        body.dark-mode .form-text,
        body.dark-mode .text-secondary,
        body.dark-mode .text-body,
        body.dark-mode .dropdown-item,
        body.dark-mode .dropdown-header {
            color: #e2e8f0 !important;
        }
        
        /* Special handling for elements that need to be slightly dimmed in dark mode */
        body.dark-mode .text-muted,
        body.dark-mode .form-text,
        body.dark-mode .text-secondary {
            color: #94a3b8 !important;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 126, 0, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 126, 0, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 126, 0, 0);
            }
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-5px);
            }
        }
        
        @keyframes shine {
            0% {
                transform: translateX(-100%) translateY(-100%) rotate(45deg);
            }
            100% {
                transform: translateX(100%) translateY(100%) rotate(45deg);
            }
        }
        
        @keyframes pulse-icon {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }
        
        @media (max-width: 768px) {
            .container-fluid {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .tax-item, .operational-item {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }
            
            .tax-item > div, .operational-item > div {
                width: 100% !important;
            }
            
            .tax-item .btn-remove, .operational-item .btn-remove {
                align-self: flex-end;
                margin-top: 0.5rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .dark-mode-toggle {
                top: -10px;
                right: 0;
            }
            
            .chart-legend {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .search-row {
                flex-direction: column;
            }
            
            .history-item {
                padding: 1rem;
            }
            
            .history-header {
                flex-direction: column;
                align-items: flex-start;
                margin-bottom: 0.5rem;
            }
            
            .history-content {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .history-profit {
                margin-left: 0;
                margin-top: 0.5rem;
                text-align: left;
            }
            
            .history-actions {
                position: static;
                opacity: 1;
                margin-top: 0.75rem;
                justify-content: flex-end;
            }
            
            .print-selection-container {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .date-filter-container, .profit-filter-container {
                justify-content: center;
            }
            
            .print-actions {
                flex-direction: column;
            }
            
            .edit-history-content {
                width: 95%;
                max-height: 95vh;
            }
            
            .visual-container {
                grid-template-columns: 1fr;
            }
            
            .responsive-print-table {
                font-size: 0.9rem;
            }
            
            .responsive-print-table th, .responsive-print-table td {
                padding: 8px 10px;
            }
            
            .social-media-inputs {
                flex-direction: column;
            }
            
            .preview-company-header {
                flex-direction: column;
                text-align: center;
            }
            
            .preview-company-logo {
                margin-right: 0;
                margin-bottom: 1rem;
            }
            
            .cute-table, .cute-tax-table, .single-product-table {
                font-size: 0.9rem;
            }
            
            .cute-table th, .cute-table td, 
            .cute-tax-table th, .cute-tax-table td,
            .single-product-table th, .single-product-table td {
                padding: 10px;
            }
            
            .cute-tax-table th:first-child {
                width: 60%; /* Lebih lebar untuk nama pajak di layar kecil */
            }
        }
        
        @media (max-width: 576px) {
            .date-filter-container, .profit-filter-container {
                flex-direction: column;
            }
            
            .date-filter-btn, .profit-filter-btn {
                width: 100%;
                text-align: center;
            }
            
            .visual-container {
                grid-template-columns: 1fr;
            }
            
            .responsive-print-table {
                font-size: 0.8rem;
            }
            
            .responsive-print-table th, .responsive-print-table td {
                padding: 6px 8px;
            }
            
            .cute-table, .cute-tax-table, .single-product-table {
                font-size: 0.8rem;
            }
            
            .cute-table th, .cute-table td, 
            .cute-tax-table th, .cute-tax-table td,
            .single-product-table th, .single-product-table td {
                padding: 8px;
            }
            
            .cute-tax-table th:first-child {
                width: 60%; /* Lebih lebar untuk nama pajak di layar kecil */
            }
        }
        
        /* Additional responsive improvements for various devices */
        @media (min-width: 1200px) {
            .container-fluid {
                padding: 3rem;
            }
        }
        
        @media (min-width: 992px) and (max-width: 1199px) {
            .container-fluid {
                padding: 2.5rem;
            }
        }
        
        @media (min-width: 768px) and (max-width: 991px) {
            .container-fluid {
                padding: 1.5rem;
            }
        }
        
        /* Improved touch targets for mobile devices */
        @media (hover: none) and (pointer: coarse) {
            .btn, .btn-remove, .countdown-btn, .restore-btn, .permanent-delete-btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            .nav-tabs .nav-link {
                padding: 1rem 1.5rem;
            }
            
            .tax-item, .operational-item {
                padding: 1.25rem;
            }
        }
        
        /* Improved text contrast for accessibility */
        @media (prefers-contrast: high) {
            .value-shape.positive {
                background-color: rgba(10, 135, 84, 0.3);
                color: #0a8754;
            }
            
            .value-shape.negative {
                background-color: rgba(196, 30, 58, 0.3);
                color: #c41e3a;
            }
            
            .value-shape.neutral {
                background-color: rgba(44, 62, 80, 0.3);
                color: #2c3e50;
            }
            
            body.dark-mode .value-shape.positive {
                background-color: rgba(0, 255, 136, 0.3);
                color: #00ff88;
            }
            
            body.dark-mode .value-shape.negative {
                background-color: rgba(255, 71, 87, 0.3);
                color: #ff4757;
            }
            
            body.dark-mode .value-shape.neutral {
                background-color: rgba(255, 255, 255, 0.3);
                color: #f1f2f6;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="header">
            <button class="dark-mode-toggle" onclick="toggleDarkMode()">
                <i class="bi bi-moon-stars-fill"></i>
            </button>
            <h1>Penghitung Keuangan</h1>
            <p>Hitung laba bersih dari bruto dengan mudah dan akurat</p>
        </div>
        
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="input-tab" data-bs-toggle="tab" data-bs-target="#input" type="button" role="tab" aria-selected="true">Input</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tax-profit-tab" data-bs-toggle="tab" data-bs-target="#tax-profit" type="button" role="tab" aria-selected="false">Pajak & Laba</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="visual-tab" data-bs-toggle="tab" data-bs-target="#visual" type="button" role="tab" aria-selected="false">Visual</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab" aria-selected="false">Riwayat</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="print-tab" data-bs-toggle="tab" data-bs-target="#print" type="button" role="tab" aria-selected="false">Cetak Laporan</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-selected="false">Profil Perusahaan</button>
            </li>
        </ul>
        
        <div class="tab-content" id="mainTabContent">
            <div class="tab-pane fade show active" id="input" role="tabpanel" aria-labelledby="input-tab">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <span><i class="bi bi-box-seam"></i> Informasi Produk</span>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="product-name" class="form-label">Nama Produk</label>
                                    <input type="text" class="form-control" id="product-name" placeholder="Contoh: Baju Kemeja">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="product-brand" class="form-label">Merek</label>
                                    <input type="text" class="form-control" id="product-brand" placeholder="Contoh: Zara">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bruto" class="form-label">Bruto</label>
                                    <div class="input-group">
                                        <span class="input-group-text">Rp</span>
                                        <input type="number" class="form-control" id="bruto" placeholder="0" oninput="formatNumber(this)">
                                    </div>
                                </div>
                                
                                <div class="mb-0">
                                    <label for="hpp" class="form-label">HPP</label>
                                    <div class="input-group">
                                        <span class="input-group-text">Rp</span>
                                        <input type="number" class="form-control" id="hpp" placeholder="0" oninput="formatNumber(this)">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <span><i class="bi bi-cart-plus"></i> Biaya Operasional</span>
                            </div>
                            <div class="card-body">
                                <div id="operational-costs">
                                    <div class="empty-state" style="padding: 1.5rem 0;">
                                        <i class="bi bi-inbox" style="font-size: 2rem;"></i>
                                        <p>Belum ada biaya operasional</p>
                                    </div>
                                </div>
                                <button class="btn-add" onclick="addOperational()"><i class="bi bi-plus-circle"></i> Tambah Biaya</button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <span><i class="bi bi-percent"></i> Biaya Pajak</span>
                            </div>
                            <div class="card-body">
                                <div id="tax-costs">
                                    <div class="empty-state" style="padding: 1.5rem 0;">
                                        <i class="bi bi-receipt" style="font-size: 2rem;"></i>
                                        <p>Belum ada biaya pajak</p>
                                    </div>
                                </div>
                                <button class="btn-add" onclick="addTax()"><i class="bi bi-plus-circle"></i> Tambah Pajak</button>
                                
                                <div class="mt-4">
                                    <button class="btn btn-primary w-100" onclick="calculateTax()">
                                        <i class="bi bi-calculator"></i> Hitung Pajak
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="tax-profit" role="tabpanel" aria-labelledby="tax-profit-tab">
                <div class="card">
                    <div class="card-header">
                        <span><i class="bi bi-graph-up"></i> Perhitungan Pajak & Laba</span>
                    </div>
                    <div class="card-body">
                        <div id="tax-calculation-details" class="empty-state">
                            <i class="bi bi-calculator"></i>
                            <p>Hitung biaya pajak terlebih dahulu</p>
                        </div>
                        
                        <div id="profit-calculation-steps" style="display: none;">
                            <div class="calculation-step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h6>Biaya Operasional</h6>
                                    <div class="formula">Total Biaya Operasional = HPP + Biaya Dropship + Biaya Pengiriman + ...</div>
                                    <div id="operational-formula-result" class="highlight-box">-</div>
                                </div>
                            </div>
                            
                            <div class="calculation-step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h6>Total HPP</h6>
                                    <div class="formula">Total HPP = HPP + Total Biaya Operasional</div>
                                    <div id="total-hpp-formula-result" class="highlight-box">-</div>
                                </div>
                            </div>
                            
                            <div class="calculation-step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h6>Laba Kotor</h6>
                                    <div class="formula">Laba Kotor = Bruto - Total HPP</div>
                                    <div id="gross-profit-formula-result" class="highlight-box">-</div>
                                </div>
                            </div>
                            
                            <div class="calculation-step">
                                <div class="step-number">4</div>
                                <div class="step-content">
                                    <h6>Laba Bersih</h6>
                                    <div class="formula">Laba Bersih = Laba Kotor - Total Pajak</div>
                                    <div id="net-profit-formula-result" class="highlight-box">-</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button class="btn btn-orange w-100" onclick="calculateNetProfit()">
                                <i class="bi bi-cash"></i> Hitung Laba Bersih
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="visual" role="tabpanel" aria-labelledby="visual-tab">
                <div id="visual-countdown-warning" style="display: none;">
                    <div class="countdown-warning">
                        <div class="countdown-text">
                            <i class="bi bi-exclamation-triangle-fill"></i> 
                            Data visual akan terhapus otomatis dalam:
                        </div>
                        <div class="countdown-timer" id="countdown-timer">15</div>
                        <div class="countdown-controls">
                            <button class="countdown-btn" id="countdown-pause-btn" onclick="toggleVisualCountdown()" title="Jeda">
                                <i class="bi bi-pause-fill" id="countdown-pause-icon"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="visual-container">
                    <div class="card">
                        <div class="card-header">
                            <span><i class="bi bi-pie-chart"></i> Visualisasi Keuangan</span>
                        </div>
                        <div class="card-body">
                            <div id="chart-container">
                                <div class="empty-state">
                                    <i class="bi bi-bar-chart"></i>
                                    <p>Hitung laba bersih terlebih dahulu</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="final-result" id="final-result-card" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="mb-0"><i class="bi bi-piggy-bank"></i> Hasil Akhir</h5>
                            <div class="text-end">
                                <span class="text-muted small" id="calculation-date"></span>
                            </div>
                        </div>
                        
                        <div class="result-item">
                            <span class="result-label">Produk</span>
                            <span class="result-value neutral" id="final-product-name">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Merek</span>
                            <span class="result-value neutral" id="final-product-brand">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Bruto</span>
                            <span class="value-shape neutral" id="final-bruto">Rp 0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Total HPP</span>
                            <span class="value-shape neutral" id="final-total-hpp">Rp 0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Laba Kotor</span>
                            <span class="value-shape" id="final-gross-profit">Rp 0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Total Pajak</span>
                            <span class="value-shape neutral" id="final-total-tax">Rp 0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label"><strong>Laba Bersih</strong></span>
                            <span class="value-shape" id="final-net-profit">Rp 0</span>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-light" onclick="printResults()">
                                <i class="bi bi-printer"></i> Cetak
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-clock-history"></i> Riwayat Perhitungan</span>
                        <div class="d-flex gap-2">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-sort-down"></i> Urutkan
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                                    <li><a class="dropdown-item active" href="#" data-sort="all" onclick="sortHistory('all')"><i class="bi bi-list-ul"></i> Semua</a></li>
                                    <li><a class="dropdown-item" href="#" data-sort="az" onclick="sortHistory('az')"><i class="bi bi-sort-alpha-down"></i> A-Z</a></li>
                                    <li><a class="dropdown-item" href="#" data-sort="za" onclick="sortHistory('za')"><i class="bi bi-sort-alpha-up"></i> Z-A</a></li>
                                    <li><a class="dropdown-item" href="#" data-sort="profit" onclick="sortHistory('profit')"><i class="bi bi-graph-up-arrow"></i> Laba Untung</a></li>
                                    <li><a class="dropdown-item" href="#" data-sort="loss" onclick="sortHistory('loss')"><i class="bi bi-graph-down-arrow"></i> Laba Rugi</a></li>
                                </ul>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="timeFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-calendar-range"></i> Waktu
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="timeFilterDropdown">
                                    <li><a class="dropdown-item active" href="#" data-time="all" onclick="filterHistoryByTime('all')"><i class="bi bi-calendar3"></i> Semua</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="30" onclick="filterHistoryByTime('30')"><i class="bi bi-calendar-month"></i> 30 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="15" onclick="filterHistoryByTime('15')"><i class="bi bi-calendar-week"></i> 15 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="7" onclick="filterHistoryByTime('7')"><i class="bi bi-calendar-week"></i> 7 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="3" onclick="filterHistoryByTime('3')"><i class="bi bi-calendar3"></i> 3 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="today" onclick="filterHistoryByTime('today')"><i class="bi bi-calendar-day"></i> Hari Ini</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="custom" onclick="filterHistoryByTime('custom')"><i class="bi bi-calendar-plus"></i> Pilih Hari</a></li>
                                </ul>
                            </div>
                            <button class="btn btn-sm btn-light" onclick="clearHistory()">
                                <i class="bi bi-trash"></i> Hapus Semua
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="search-section">
                            <div class="search-title">Cari Produk</div>
                            <div class="search-row">
                                <div class="search-col">
                                    <div class="search-container">
                                        <i class="bi bi-search search-icon"></i>
                                        <input type="text" class="form-control search-input" id="product-search" placeholder="Cari berdasarkan nama produk...">
                                    </div>
                                </div>
                                <div class="search-col">
                                    <div class="search-container">
                                        <i class="bi bi-tag search-icon"></i>
                                        <input type="text" class="form-control search-input" id="brand-search" placeholder="Cari berdasarkan merek...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tambahkan container untuk custom date filter (awalnya disembunyikan) -->
                        <div id="custom-date-container-history" style="display: none; margin-bottom: 1rem;">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="start-date-history" class="form-label">Tanggal Mulai</label>
                                    <input type="date" class="form-control" id="start-date-history">
                                </div>
                                <div class="col-md-6">
                                    <label for="end-date-history" class="form-label">Tanggal Selesai</label>
                                    <input type="date" class="form-control" id="end-date-history">
                                </div>
                            </div>
                            <div class="mt-2">
                                <button class="btn btn-primary btn-sm" onclick="applyCustomDateFilterHistory()">Terapkan Filter</button>
                            </div>
                        </div>
                        
                        <div id="history-container" class="history-container">
                            <div class="empty-state">
                                <i class="bi bi-hourglass-split"></i>
                                <p>Belum ada riwayat perhitungan</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-file-earmark-text"></i> Riwayat Laporan</span>
                        <div class="d-flex gap-2">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="reportTimeFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-calendar-range"></i> Waktu
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="reportTimeFilterDropdown">
                                    <li><a class="dropdown-item active" href="#" data-time="all" onclick="filterReportSummaryByDate('all')"><i class="bi bi-calendar3"></i> Semua</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="30" onclick="filterReportSummaryByDate('30')"><i class="bi bi-calendar-month"></i> 30 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="15" onclick="filterReportSummaryByDate('15')"><i class="bi bi-calendar-week"></i> 15 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="7" onclick="filterReportSummaryByDate('7')"><i class="bi bi-calendar-week"></i> 7 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="3" onclick="filterReportSummaryByDate('3')"><i class="bi bi-calendar3"></i> 3 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="today" onclick="filterReportSummaryByDate('today')"><i class="bi bi-calendar-day"></i> Hari Ini</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="custom" onclick="filterReportSummaryByDate('custom')"><i class="bi bi-calendar-plus"></i> Pilih Hari</a></li>
                                </ul>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="reportProfitFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-graph-up"></i> Laba
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="reportProfitFilterDropdown">
                                    <li><a class="dropdown-item active" href="#" data-profit="all" onclick="filterReportSummaryByProfit('all')"><i class="bi bi-list-ul"></i> Semua</a></li>
                                    <li><a class="dropdown-item" href="#" data-profit="profit" onclick="filterReportSummaryByProfit('profit')"><i class="bi bi-graph-up-arrow"></i> Laba Untung</a></li>
                                    <li><a class="dropdown-item" href="#" data-profit="loss" onclick="filterReportSummaryByProfit('loss')"><i class="bi bi-graph-down-arrow"></i> Laba Rugi</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Container untuk custom date filter (awalnya disembunyikan) -->
                        <div id="custom-date-container-report" style="display: none; margin-bottom: 1rem;">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="start-date-report" class="form-label">Tanggal Mulai</label>
                                    <input type="date" class="form-control" id="start-date-report">
                                </div>
                                <div class="col-md-6">
                                    <label for="end-date-report" class="form-label">Tanggal Selesai</label>
                                    <input type="date" class="form-control" id="end-date-report">
                                </div>
                            </div>
                            <div class="mt-2">
                                <button class="btn btn-primary btn-sm" onclick="applyCustomDateFilterReport()">Terapkan Filter</button>
                            </div>
                        </div>
                        
                        <div id="report-summary" class="report-summary">
                            <div class="report-title">
                                <i class="bi bi-graph-up-arrow"></i> Ringkasan Laporan
                            </div>
                            <div class="report-row">
                                <span class="report-label">Total Transaksi</span>
                                <span class="report-value" id="total-transactions">0</span>
                            </div>
                            <div class="report-row">
                                <span class="report-label">Total Bruto</span>
                                <span class="report-value" id="total-bruto-report">Rp 0</span>
                            </div>
                            <div class="report-row">
                                <span class="report-label">Total HPP</span>
                                <span class="report-value" id="total-hpp-report">Rp 0</span>
                            </div>
                            <div class="report-row">
                                <span class="report-label">Total Laba Kotor</span>
                                <span class="report-value" id="total-gross-profit-report">Rp 0</span>
                            </div>
                            <div class="report-row">
                                <span class="report-label">Total Pajak</span>
                                <span class="report-value" id="total-tax-report">Rp 0</span>
                            </div>
                            <div class="report-row">
                                <span class="report-label"><strong>TOTAL LABA BERSIH</strong></span>
                                <span class="value-shape" id="total-net-profit-report">Rp 0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-trash"></i> Riwayat Penghapusan</span>
                        <div class="d-flex gap-2">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="deletedSortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-sort-down"></i> Urutkan
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="deletedSortDropdown">
                                    <li><a class="dropdown-item active" href="#" data-sort="all" onclick="sortDeletedHistory('all')"><i class="bi bi-list-ul"></i> Semua</a></li>
                                    <li><a class="dropdown-item" href="#" data-sort="az" onclick="sortDeletedHistory('az')"><i class="bi bi-sort-alpha-down"></i> A-Z</a></li>
                                    <li><a class="dropdown-item" href="#" data-sort="za" onclick="sortDeletedHistory('za')"><i class="bi bi-sort-alpha-up"></i> Z-A</a></li>
                                    <li><a class="dropdown-item" href="#" data-sort="profit" onclick="sortDeletedHistory('profit')"><i class="bi bi-graph-up-arrow"></i> Laba Untung</a></li>
                                    <li><a class="dropdown-item" href="#" data-sort="loss" onclick="sortDeletedHistory('loss')"><i class="bi bi-graph-down-arrow"></i> Laba Rugi</a></li>
                                </ul>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="deletedTimeFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-calendar-range"></i> Waktu
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="deletedTimeFilterDropdown">
                                    <li><a class="dropdown-item active" href="#" data-time="all" onclick="filterDeletedHistoryByTime('all')"><i class="bi bi-calendar3"></i> Semua</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="30" onclick="filterDeletedHistoryByTime('30')"><i class="bi bi-calendar-month"></i> 30 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="15" onclick="filterDeletedHistoryByTime('15')"><i class="bi bi-calendar-week"></i> 15 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="7" onclick="filterDeletedHistoryByTime('7')"><i class="bi bi-calendar-week"></i> 7 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="3" onclick="filterDeletedHistoryByTime('3')"><i class="bi bi-calendar3"></i> 3 Hari</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="today" onclick="filterDeletedHistoryByTime('today')"><i class="bi bi-calendar-day"></i> Hari Ini</a></li>
                                    <li><a class="dropdown-item" href="#" data-time="custom" onclick="filterDeletedHistoryByTime('custom')"><i class="bi bi-calendar-plus"></i> Pilih Hari</a></li>
                                </ul>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="deletedProfitFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bi bi-graph-up"></i> Laba
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="deletedProfitFilterDropdown">
                                    <li><a class="dropdown-item active" href="#" data-profit="all" onclick="filterDeletedHistoryByProfit('all')"><i class="bi bi-list-ul"></i> Semua</a></li>
                                    <li><a class="dropdown-item" href="#" data-profit="profit" onclick="filterDeletedHistoryByProfit('profit')"><i class="bi bi-graph-up-arrow"></i> Laba Untung</a></li>
                                    <li><a class="dropdown-item" href="#" data-profit="loss" onclick="filterDeletedHistoryByProfit('loss')"><i class="bi bi-graph-down-arrow"></i> Laba Rugi</a></li>
                                </ul>
                            </div>
                            <button class="btn btn-sm btn-light" onclick="clearDeletedHistory()">
                                <i class="bi bi-trash"></i> Hapus Semua
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="search-section">
                            <div class="search-title">Cari Produk</div>
                            <div class="search-row">
                                <div class="search-col">
                                    <div class="search-container">
                                        <i class="bi bi-search search-icon"></i>
                                        <input type="text" class="form-control search-input" id="deleted-product-search" placeholder="Cari berdasarkan nama produk...">
                                    </div>
                                </div>
                                <div class="search-col">
                                    <div class="search-container">
                                        <i class="bi bi-tag search-icon"></i>
                                        <input type="text" class="form-control search-input" id="deleted-brand-search" placeholder="Cari berdasarkan merek...">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tambahkan container untuk custom date filter (awalnya disembunyikan) -->
                        <div id="custom-date-container-deleted" style="display: none; margin-bottom: 1rem;">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="start-date-deleted" class="form-label">Tanggal Mulai</label>
                                    <input type="date" class="form-control" id="start-date-deleted">
                                </div>
                                <div class="col-md-6">
                                    <label for="end-date-deleted" class="form-label">Tanggal Selesai</label>
                                    <input type="date" class="form-control" id="end-date-deleted">
                                </div>
                            </div>
                            <div class="mt-2">
                                <button class="btn btn-primary btn-sm" onclick="applyCustomDateFilterDeleted()">Terapkan Filter</button>
                            </div>
                        </div>
                        
                        <div id="deleted-history-container" class="history-container">
                            <div class="empty-state">
                                <i class="bi bi-recycle"></i>
                                <p>Belum ada riwayat penghapusan</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="print" role="tabpanel" aria-labelledby="print-tab">
                <div class="card">
                    <div class="card-header">
                        <span><i class="bi bi-printer"></i> Cetak Laporan</span>
                    </div>
                    <div class="card-body">
                        <div class="filter-container">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">Filter Data</h5>
                                <div class="d-flex gap-2">
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="printTimeFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-calendar-range"></i> Waktu
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="printTimeFilterDropdown">
                                            <li><a class="dropdown-item active" href="#" data-time="all" onclick="filterPrintByTime('all')"><i class="bi bi-calendar3"></i> Semua</a></li>
                                            <li><a class="dropdown-item" href="#" data-time="30" onclick="filterPrintByTime('30')"><i class="bi bi-calendar-month"></i> 30 Hari</a></li>
                                            <li><a class="dropdown-item" href="#" data-time="15" onclick="filterPrintByTime('15')"><i class="bi bi-calendar-week"></i> 15 Hari</a></li>
                                            <li><a class="dropdown-item" href="#" data-time="7" onclick="filterPrintByTime('7')"><i class="bi bi-calendar-week"></i> 7 Hari</a></li>
                                            <li><a class="dropdown-item" href="#" data-time="3" onclick="filterPrintByTime('3')"><i class="bi bi-calendar3"></i> 3 Hari</a></li>
                                            <li><a class="dropdown-item" href="#" data-time="today" onclick="filterPrintByTime('today')"><i class="bi bi-calendar-day"></i> Hari Ini</a></li>
                                            <li><a class="dropdown-item" href="#" data-time="custom" onclick="filterPrintByTime('custom')"><i class="bi bi-calendar-plus"></i> Pilih Hari</a></li>
                                        </ul>
                                    </div>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-light dropdown-toggle" type="button" id="printProfitFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-graph-up"></i> Laba
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="printProfitFilterDropdown">
                                            <li><a class="dropdown-item active" href="#" data-profit="all" onclick="filterPrintByProfit('all')"><i class="bi bi-list-ul"></i> Semua</a></li>
                                            <li><a class="dropdown-item" href="#" data-profit="profit" onclick="filterPrintByProfit('profit')"><i class="bi bi-graph-up-arrow"></i> Laba Untung</a></li>
                                            <li><a class="dropdown-item" href="#" data-profit="loss" onclick="filterPrintByProfit('loss')"><i class="bi bi-graph-down-arrow"></i> Laba Rugi</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Container untuk custom date filter (awalnya disembunyikan) -->
                            <div id="custom-date-container-print" style="display: none; margin-bottom: 1rem;">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label for="start-date-print" class="form-label">Tanggal Mulai</label>
                                        <input type="date" class="form-control" id="start-date-print">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="end-date-print" class="form-label">Tanggal Selesai</label>
                                        <input type="date" class="form-control" id="end-date-print">
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <button class="btn btn-primary btn-sm" onclick="applyCustomDateFilterPrint()">Terapkan Filter</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="print-selection-container">
                            <div class="print-selection-title">Pilih Produk yang Akan Dicetak</div>
                            <div>
                                <button class="btn btn-sm btn-light" id="select-all-btn" onclick="selectAllItems()">
                                    <i class="bi bi-check-all"></i> Pilih Semua
                                </button>
                                <button class="btn btn-sm btn-light" id="clear-selection-btn" onclick="clearSelection()">
                                    <i class="bi bi-x-circle"></i> Hapus Pilihan
                                </button>
                            </div>
                        </div>
                        
                        <div id="print-history-container" class="history-container">
                            <div class="empty-state">
                                <i class="bi bi-printer"></i>
                                <p>Belum ada riwayat untuk dicetak</p>
                            </div>
                        </div>
                        
                        <div class="print-actions">
                            <button class="btn btn-orange" onclick="printSelectedItems()">
                                <i class="bi bi-printer"></i> Cetak yang Dipilih
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                <div class="card">
                    <div class="card-header">
                        <span><i class="bi bi-building"></i> Profil Perusahaan</span>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="company-name" class="form-label">Nama Perusahaan</label>
                                    <input type="text" class="form-control" id="company-name" placeholder="Contoh: PT Maju Bersama">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="company-tagline" class="form-label">Tagline</label>
                                    <input type="text" class="form-control" id="company-tagline" placeholder="Contoh: Solusi Terpercaya Untuk Bisnis Anda">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="company-established" class="form-label">Tahun Berdiri</label>
                                    <input type="number" class="form-control" id="company-established" placeholder="Contoh: 2010" min="1800" max="2099">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="company-entity" class="form-label">Bentuk Badan Hukum</label>
                                    <select class="form-control" id="company-entity">
                                        <option value="">Pilih bentuk badan hukum</option>
                                        <option value="PT">PT (Perseroan Terbatas)</option>
                                        <option value="CV">CV (Commanditaire Vennootschap)</option>
                                        <option value="Firma">Firma</option>
                                        <option value="UD">UD (Usaha Dagang)</option>
                                        <option value="Koperasi">Koperasi</option>
                                        <option value="Yayasan">Yayasan</option>
                                        <option value="Lainnya">Lainnya</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="company-address" class="form-label">Alamat Kantor Pusat</label>
                                    <textarea class="form-control" id="company-address" rows="3" placeholder="Masukkan alamat lengkap kantor pusat"></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="company-branches" class="form-label">Alamat Kantor Cabang</label>
                                    <textarea class="form-control" id="company-branches" rows="3" placeholder="Masukkan alamat kantor cabang (pisahkan dengan koma untuk multiple cabang)"></textarea>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="company-logo-container">
                                    <div class="company-logo-preview" id="company-logo-preview">
                                        <div class="company-logo-placeholder">
                                            <i class="bi bi-image"></i>
                                            <p>Logo Perusahaan</p>
                                        </div>
                                    </div>
                                    <input type="file" class="form-control" id="company-logo" accept="image/*" onchange="previewCompanyLogo(this)">
                                    <button class="btn btn-sm btn-light mt-2" onclick="removeCompanyLogo()">
                                        <i class="bi bi-trash"></i> Hapus Logo
                                    </button>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Kontak Perusahaan</label>
                                    <div class="contact-inputs">
                                        <div>
                                            <input type="text" class="form-control" id="company-phone" placeholder="Telepon">
                                        </div>
                                        <div>
                                            <input type="email" class="form-control" id="company-email" placeholder="Email">
                                        </div>
                                        <div>
                                            <input type="text" class="form-control" id="company-website" placeholder="Website">
                                        </div>
                                        <div>
                                            <input type="text" class="form-control" id="company-whatsapp" placeholder="WhatsApp">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Media Sosial</label>
                                    <div class="social-media-inputs">
                                        <div class="social-media-input">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-instagram"></i></span>
                                                <input type="text" class="form-control" id="company-instagram" placeholder="Instagram">
                                            </div>
                                        </div>
                                        <div class="social-media-input">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-facebook"></i></span>
                                                <input type="text" class="form-control" id="company-facebook" placeholder="Facebook">
                                            </div>
                                        </div>
                                        <div class="social-media-input">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-tiktok"></i></span>
                                                <input type="text" class="form-control" id="company-tiktok" placeholder="TikTok">
                                            </div>
                                        </div>
                                        <div class="social-media-input">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-twitter"></i></span>
                                                <input type="text" class="form-control" id="company-twitter" placeholder="Twitter">
                                            </div>
                                        </div>
                                        <div class="social-media-input">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-youtube"></i></span>
                                                <input type="text" class="form-control" id="company-youtube" placeholder="YouTube">
                                            </div>
                                        </div>
                                        <div class="social-media-input">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-linkedin"></i></span>
                                                <input type="text" class="form-control" id="company-linkedin" placeholder="LinkedIn">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="preview-company-profile" id="preview-company-profile">
                            <div class="preview-company-header">
                                <div class="preview-company-logo" id="preview-logo">
                                    <i class="bi bi-building"></i>
                                </div>
                                <div class="preview-company-info">
                                    <h5 id="preview-name">Nama Perusahaan</h5>
                                    <p id="preview-tagline">Tagline Perusahaan</p>
                                </div>
                            </div>
                            <div class="preview-company-details">
                                <div class="preview-company-detail" id="preview-established-container" style="display: none;">
                                    <i class="bi bi-calendar-event"></i>
                                    <span id="preview-established">Tahun Berdiri</span>
                                </div>
                                <div class="preview-company-detail" id="preview-entity-container" style="display: none;">
                                    <i class="bi bi-building"></i>
                                    <span id="preview-entity">Bentuk Badan Hukum</span>
                                </div>
                                <div class="preview-company-detail" id="preview-address-container" style="display: none;">
                                    <i class="bi bi-geo-alt"></i>
                                    <span id="preview-address">Alamat Kantor Pusat</span>
                                </div>
                                <div class="preview-company-detail" id="preview-phone-container" style="display: none;">
                                    <i class="bi bi-telephone"></i>
                                    <span id="preview-phone">Telepon</span>
                                </div>
                                <div class="preview-company-detail" id="preview-email-container" style="display: none;">
                                    <i class="bi bi-envelope"></i>
                                    <span id="preview-email">Email</span>
                                </div>
                                <div class="preview-company-detail" id="preview-website-container" style="display: none;">
                                    <i class="bi bi-globe"></i>
                                    <span id="preview-website">Website</span>
                                </div>
                            </div>
                            <div class="preview-social-media" id="preview-social-media"></div>
                        </div>
                        
                        <div class="action-buttons mt-4">
                            <button class="btn btn-primary" onclick="saveCompanyProfile()">
                                <i class="bi bi-save"></i> Simpan Profil
                            </button>
                            <button class="btn btn-light" onclick="resetCompanyProfile()">
                                <i class="bi bi-arrow-clockwise"></i> Reset
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit History Modal -->
    <div class="edit-history-modal" id="edit-history-modal">
        <div class="edit-history-content">
            <div class="edit-history-header">
                <h3 class="edit-history-title">Edit Riwayat Perhitungan</h3>
                <button class="btn-remove" onclick="closeEditHistoryModal()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="edit-history-body">
                <div class="mb-3">
                    <label for="edit-product-name" class="form-label">Nama Produk</label>
                    <input type="text" class="form-control" id="edit-product-name">
                </div>
                
                <div class="mb-3">
                    <label for="edit-product-brand" class="form-label">Merek</label>
                    <input type="text" class="form-control" id="edit-product-brand">
                </div>
                
                <div class="mb-3">
                    <label for="edit-bruto" class="form-label">Bruto</label>
                    <div class="input-group">
                        <span class="input-group-text">Rp</span>
                        <input type="number" class="form-control" id="edit-bruto">
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="edit-hpp" class="form-label">HPP</label>
                    <div class="input-group">
                        <span class="input-group-text">Rp</span>
                        <input type="number" class="form-control" id="edit-hpp">
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="edit-gross-profit" class="form-label">Laba Kotor</label>
                    <div class="input-group">
                        <span class="input-group-text">Rp</span>
                        <input type="number" class="form-control" id="edit-gross-profit">
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="edit-total-tax" class="form-label">Total Pajak</label>
                    <div class="input-group">
                        <span class="input-group-text">Rp</span>
                        <input type="number" class="form-control" id="edit-total-tax">
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="edit-net-profit" class="form-label">Laba Bersih</label>
                    <div class="input-group">
                        <span class="input-group-text">Rp</span>
                        <input type="number" class="form-control" id="edit-net-profit">
                    </div>
                </div>
            </div>
            <div class="edit-history-footer">
                <button class="btn btn-light" onclick="closeEditHistoryModal()">Batal</button>
                <button class="btn btn-primary" onclick="saveEditedHistoryItem()">Simpan Perubahan</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                const icon = document.querySelector('.dark-mode-toggle i');
                icon.className = 'bi bi-sun-fill';
            }
            
            // Load company profile if exists
            loadCompanyProfile();
            
            // Update history displays
            updateHistoryDisplay();
            updateDeletedHistoryDisplay();
            updatePrintHistoryDisplay();
            updateReportSummary();
            
            // Setup search functionality with debounce for product search
            let productSearchTimeout;
            const productSearchInput = document.getElementById('product-search');
            if (productSearchInput) {
                productSearchInput.addEventListener('input', function() {
                    clearTimeout(productSearchTimeout);
                    
                    if (this.value.trim() === '') {
                        // If search term is empty, show all items
                        displayAllHistoryItems();
                        return;
                    }
                    
                    productSearchTimeout = setTimeout(() => {
                        searchProducts(this.value);
                    }, 300); // 300ms delay
                });
            }
            
            // Setup search functionality with debounce for brand search
            let brandSearchTimeout;
            const brandSearchInput = document.getElementById('brand-search');
            if (brandSearchInput) {
                brandSearchInput.addEventListener('input', function() {
                    clearTimeout(brandSearchTimeout);
                    
                    if (this.value.trim() === '') {
                        // If search term is empty, show all items
                        displayAllHistoryItems();
                        return;
                    }
                    
                    brandSearchTimeout = setTimeout(() => {
                        searchBrands(this.value);
                    }, 300); // 300ms delay
                });
            }
            
            // Setup search functionality with debounce for deleted product search
            let deletedProductSearchTimeout;
            const deletedProductSearchInput = document.getElementById('deleted-product-search');
            if (deletedProductSearchInput) {
                deletedProductSearchInput.addEventListener('input', function() {
                    clearTimeout(deletedProductSearchTimeout);
                    
                    if (this.value.trim() === '') {
                        // If search term is empty, show all items
                        displayAllDeletedHistoryItems();
                        return;
                    }
                    
                    deletedProductSearchTimeout = setTimeout(() => {
                        searchDeletedProducts(this.value);
                    }, 300); // 300ms delay
                });
            }

            // Setup search functionality with debounce for deleted brand search
            let deletedBrandSearchTimeout;
            const deletedBrandSearchInput = document.getElementById('deleted-brand-search');
            if (deletedBrandSearchInput) {
                deletedBrandSearchInput.addEventListener('input', function() {
                    clearTimeout(deletedBrandSearchTimeout);
                    
                    if (this.value.trim() === '') {
                        // If search term is empty, show all items
                        displayAllDeletedHistoryItems();
                        return;
                    }
                    
                    deletedBrandSearchTimeout = setTimeout(() => {
                        searchDeletedBrands(this.value);
                    }, 300); // 300ms delay
                });
            }
            
            // Setup dropdown filter waktu untuk report summary
            const reportTimeFilterDropdown = document.getElementById('reportTimeFilterDropdown');
            if (reportTimeFilterDropdown) {
                const dropdownItems = reportTimeFilterDropdown.nextElementSibling.querySelectorAll('.dropdown-item');
                dropdownItems.forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Remove active class from all items
                        dropdownItems.forEach(i => i.classList.remove('active'));
                        // Add active class to clicked item
                        this.classList.add('active');
                        
                        const filter = this.getAttribute('data-time');
                        
                        // Show/hide custom date container based on filter
                        const customDateContainer = document.getElementById('custom-date-container-report');
                        if (filter === 'custom') {
                            customDateContainer.style.display = 'block';
                        } else {
                            customDateContainer.style.display = 'none';
                            // Filter report based on selected date range
                            filterReportSummaryByDate(filter);
                        }
                    });
                });
            }
            
            // Setup dropdown filter laba untuk report summary
            const reportProfitFilterDropdown = document.getElementById('reportProfitFilterDropdown');
            if (reportProfitFilterDropdown) {
                const dropdownItems = reportProfitFilterDropdown.nextElementSibling.querySelectorAll('.dropdown-item');
                dropdownItems.forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Remove active class from all items
                        dropdownItems.forEach(i => i.classList.remove('active'));
                        // Add active class to clicked item
                        this.classList.add('active');
                        
                        const profitFilter = this.getAttribute('data-profit');
                        
                        // Filter report based on profit
                        filterReportSummaryByProfit(profitFilter);
                    });
                });
            }

            // Setup dropdown filter waktu untuk deleted history
            const deletedTimeFilterDropdown = document.getElementById('deletedTimeFilterDropdown');
            if (deletedTimeFilterDropdown) {
                const dropdownItems = deletedTimeFilterDropdown.nextElementSibling.querySelectorAll('.dropdown-item');
                dropdownItems.forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Remove active class from all items
                        dropdownItems.forEach(i => i.classList.remove('active'));
                        // Add active class to clicked item
                        this.classList.add('active');
                        
                        const filter = this.getAttribute('data-time');
                        
                        // Show/hide custom date container based on filter
                        const customDateContainer = document.getElementById('custom-date-container-deleted');
                        if (filter === 'custom') {
                            customDateContainer.style.display = 'block';
                        } else {
                            customDateContainer.style.display = 'none';
                            // Filter deleted history based on selected date range
                            filterDeletedHistoryByTime(filter);
                        }
                    });
                });
            }

            // Setup dropdown filter laba untuk deleted history
            const deletedProfitFilterDropdown = document.getElementById('deletedProfitFilterDropdown');
            if (deletedProfitFilterDropdown) {
                const dropdownItems = deletedProfitFilterDropdown.nextElementSibling.querySelectorAll('.dropdown-item');
                dropdownItems.forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        // Remove active class from all items
                        dropdownItems.forEach(i => i.classList.remove('active'));
                        // Add active class to clicked item
                        this.classList.add('active');
                        
                        const profitFilter = this.getAttribute('data-profit');
                        
                        // Filter deleted history based on profit
                        filterDeletedHistoryByProfit(profitFilter);
                    });
                });
            }
            
            // Auto calculate tax values when bruto or percentage changes
            document.addEventListener('input', function(e) {
                if (e.target.matches('#bruto, .tax-percentage')) {
                    const bruto = parseFloat(document.getElementById('bruto').value.replace(/\./g, '')) || 0;
                    
                    if (bruto > 0) {
                        const taxItems = document.querySelectorAll('.tax-item');
                        taxItems.forEach(item => {
                            const percentage = parseFloat(item.querySelector('.tax-percentage').value) || 0;
                            const taxValue = bruto * percentage / 100;
                            item.querySelector('.tax-value').value = formatCurrency(taxValue);
                        });
                    }
                }
            });
            
            // Add event listener for tab switching
            document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(event) {
                    // If switching to visual tab and there's data, start countdown
                    if (event.target.getAttribute('data-bs-target') === '#visual') {
                        if (document.getElementById('final-result-card').style.display !== 'none') {
                            startVisualCountdown();
                        }
                    } else {
                        // If switching away from visual tab, stop countdown
                        stopVisualCountdown();
                    }
                });
            });
            
            // Setup company profile preview
            setupCompanyProfilePreview();
        });

        let visualCountdownInterval = null;
        let visualCountdownSeconds = 15;
        let visualCountdownPaused = false;

        function startVisualCountdown() {
            // Show countdown warning
            document.getElementById('visual-countdown-warning').style.display = 'block';
            
            // Reset countdown timer
            visualCountdownSeconds = 15;
            visualCountdownPaused = false;
            document.getElementById('countdown-timer').textContent = visualCountdownSeconds;
            
            // Update pause button icon
            document.getElementById('countdown-pause-icon').className = 'bi bi-pause-fill';
            
            // Clear any existing interval
            if (visualCountdownInterval) {
                clearInterval(visualCountdownInterval);
            }
            
            // Start countdown
            visualCountdownInterval = setInterval(() => {
                if (!visualCountdownPaused) {
                    visualCountdownSeconds--;
                    document.getElementById('countdown-timer').textContent = visualCountdownSeconds;
                    
                    if (visualCountdownSeconds <= 0) {
                        // Clear visual data
                        clearVisualData();
                        stopVisualCountdown();
                        showNotification('Data visual telah dihapus otomatis', 'info');
                    }
                }
            }, 1000);
        }

        function toggleVisualCountdown() {
            visualCountdownPaused = !visualCountdownPaused;
            
            // Update pause button icon
            const icon = document.getElementById('countdown-pause-icon');
            if (visualCountdownPaused) {
                icon.className = 'bi bi-play-fill';
            } else {
                icon.className = 'bi bi-pause-fill';
            }
        }

        function stopVisualCountdown() {
            // Hide countdown warning
            document.getElementById('visual-countdown-warning').style.display = 'none';
            
            // Clear interval
            if (visualCountdownInterval) {
                clearInterval(visualCountdownInterval);
                visualCountdownInterval = null;
            }
            
            visualCountdownPaused = false;
        }

        function clearVisualData() {
            // Clear chart
            document.getElementById('chart-container').innerHTML = `
                <div class="empty-state">
                    <i class="bi bi-bar-chart"></i>
                    <p>Data telah dihapus otomatis</p>
                </div>
            `;
            
            // Hide final result card
            document.getElementById('final-result-card').style.display = 'none';
        }

        // Format number with thousand separators
        function formatNumber(input) {
            let value = input.value.replace(/\./g, '');
            if (value) {
                value = parseInt(value);
                if (!isNaN(value)) {
                    input.value = value.toLocaleString('id-ID');
                }
            }
        }

        function formatCurrency(value) {
            return "Rp " + parseFloat(value).toLocaleString('id-ID');
        }

        function addOperational() {
            const container = document.getElementById('operational-costs');
            
            // Remove empty state if it exists
            const emptyState = container.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }
            
            const newItem = document.createElement('div');
            newItem.className = 'operational-item';
            newItem.innerHTML = `
                <input type="text" class="form-control operational-name" placeholder="Nama biaya">
                <div class="input-group">
                    <span class="input-group-text">Rp</span>
                    <input type="number" class="form-control operational-value" placeholder="0" oninput="formatNumber(this)">
                </div>
                <button class="btn-remove" onclick="removeOperational(this)"><i class="bi bi-trash"></i></button>
            `;
            container.appendChild(newItem);
            
            // Add animation
            newItem.style.opacity = '0';
            newItem.style.transform = 'translateY(20px)';
            setTimeout(() => {
                newItem.style.opacity = '1';
                newItem.style.transform = 'translateY(0)';
            }, 10);
        }

        function removeOperational(button) {
            // Add animation before removing
            const item = button.parentElement;
            item.style.opacity = '0';
            item.style.transform = 'translateX(-20px)';
            
            setTimeout(() => {
                item.remove();
                
                // Check if we need to show empty state
                const container = document.getElementById('operational-costs');
                if (container.children.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="padding: 1.5rem 0;">
                            <i class="bi bi-inbox" style="font-size: 2rem;"></i>
                            <p>Belum ada biaya operasional</p>
                        </div>
                    `;
                }
            }, 300);
        }

        function addTax() {
            const container = document.getElementById('tax-costs');
            
            // Remove empty state if it exists
            const emptyState = container.querySelector('.empty-state');
            if (emptyState) {
                emptyState.remove();
            }
            
            const newItem = document.createElement('div');
            newItem.className = 'tax-item';
            newItem.innerHTML = `
                <input type="text" class="form-control tax-name" placeholder="Nama pajak">
                <div class="tax-percentage-container">
                    <input type="number" class="form-control tax-percentage-input tax-percentage" placeholder="0" step="0.1">
                    <span class="tax-percentage-suffix">%</span>
                </div>
                <div class="tax-value-container">
                    <span class="tax-value-prefix">Rp</span>
                    <input type="text" class="form-control tax-value-input tax-value" placeholder="0" readonly>
                </div>
                <button class="btn-remove" onclick="removeTax(this)"><i class="bi bi-trash"></i></button>
            `;
            container.appendChild(newItem);
            
            // Add animation
            newItem.style.opacity = '0';
            newItem.style.transform = 'translateY(20px)';
            setTimeout(() => {
                newItem.style.opacity = '1';
                newItem.style.transform = 'translateY(0)';
            }, 10);
        }

        function removeTax(button) {
            // Add animation before removing
            const item = button.parentElement;
            item.style.opacity = '0';
            item.style.transform = 'translateX(-20px)';
            
            setTimeout(() => {
                item.remove();
                
                // Check if we need to show empty state
                const container = document.getElementById('tax-costs');
                if (container.children.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="padding: 1.5rem 0;">
                            <i class="bi bi-receipt" style="font-size: 2rem;"></i>
                            <p>Belum ada biaya pajak</p>
                        </div>
                    `;
                }
            }, 300);
        }

        function validateInputs() {
            const productName = document.getElementById('product-name').value.trim();
            const brutoValue = document.getElementById('bruto').value.replace(/\./g, '');
            const bruto = parseFloat(brutoValue) || 0;
            const hppValue = document.getElementById('hpp').value.replace(/\./g, '');
            const hpp = parseFloat(hppValue) || 0;
            
            if (!productName) {
                showNotification('Masukkan nama produk', 'error');
                return false;
            }
            
            if (bruto <= 0) {
                showNotification('Masukkan nilai bruto yang valid', 'error');
                return false;
            }
            
            if (hpp < 0) {
                showNotification('HPP tidak boleh negatif', 'error');
                return false;
            }
            
            if (hpp > bruto) {
                showNotification('HPP tidak boleh lebih besar dari bruto', 'error');
                return false;
            }
            
            // Validate operational costs
            const operationalItems = document.querySelectorAll('.operational-item');
            for (const item of operationalItems) {
                const valueText = item.querySelector('.operational-value').value.replace(/\./g, '');
                const value = parseFloat(valueText) || 0;
                if (value < 0) {
                    showNotification('Biaya operasional tidak boleh negatif', 'error');
                    return false;
                }
            }
            
            // Validate tax percentages
            const taxItems = document.querySelectorAll('.tax-item');
            for (const item of taxItems) {
                const percentage = parseFloat(item.querySelector('.tax-percentage').value) || 0;
                if (percentage < 0) {
                    showNotification('Persentase pajak tidak boleh negatif', 'error');
                    return false;
                }
            }
            
            return true;
        }

        function calculateTax() {
            if (!validateInputs()) {
                return;
            }
            
            // Get bruto value
            const brutoValue = document.getElementById('bruto').value.replace(/\./g, '');
            const bruto = parseFloat(brutoValue) || 0;
            
            // Check if there are any tax items
            const taxItems = document.querySelectorAll('.tax-item');
            if (taxItems.length === 0) {
                showNotification('Tambahkan minimal satu biaya pajak', 'error');
                return;
            }
            
            // Calculate tax costs
            let totalTax = 0;
            let totalTaxPercentage = 0;
            let taxBreakdown = '';
            
            taxItems.forEach(item => {
                const name = item.querySelector('.tax-name').value || 'Pajak';
                const percentage = parseFloat(item.querySelector('.tax-percentage').value) || 0;
                
                // Calculate tax value from percentage
                const taxValue = bruto * percentage / 100;
                
                // Update the tax value input with formatted currency
                item.querySelector('.tax-value').value = formatCurrency(taxValue);
                
                totalTax += taxValue;
                totalTaxPercentage += percentage;
                
                taxBreakdown += `
                    <div class="result-item">
                        <span class="result-label">${name} (${percentage}%)</span>
                        <span class="value-shape neutral">${formatCurrency(taxValue)}</span>
                    </div>
                `;
            });
            
            // Add total tax to breakdown
            taxBreakdown += `
                <div class="highlight-box">
                    <div class="result-item">
                        <span class="result-label"><strong>Total Pajak (${totalTaxPercentage.toFixed(1)}%)</strong></span>
                        <span class="value-shape neutral"><strong>${formatCurrency(totalTax)}</strong></span>
                    </div>
                </div>
            `;
            
            // Update tax calculation details
            document.getElementById('tax-calculation-details').innerHTML = taxBreakdown;
            
            // Show profit calculation steps
            document.getElementById('profit-calculation-steps').style.display = 'block';
            
            // Switch to tax & profit tab
            const taxProfitTab = new bootstrap.Tab(document.getElementById('tax-profit-tab'));
            taxProfitTab.show();
            
            // Store total tax globally for later use
            window.calculatedTotalTax = totalTax;
            
            showNotification('Perhitungan pajak berhasil', 'success');
        }

        function calculateOperational() {
            // Get HPP value
            const hppValue = document.getElementById('hpp').value.replace(/\./g, '');
            const hpp = parseFloat(hppValue) || 0;
            
            // Calculate operational costs
            const operationalItems = document.querySelectorAll('.operational-item');
            let totalOperational = 0;
            let operationalBreakdown = '';
            
            if (operationalItems.length > 0) {
                operationalItems.forEach((item, index) => {
                    const name = item.querySelector('.operational-name').value || 'Biaya Operasional';
                    const valueText = item.querySelector('.operational-value').value.replace(/\./g, '');
                    const value = parseFloat(valueText) || 0;
                    totalOperational += value;
                    
                    if (operationalBreakdown === '') {
                        operationalBreakdown = `${name}: ${formatCurrency(value)}`;
                    } else {
                        operationalBreakdown += ` + ${name}: ${formatCurrency(value)}`;
                    }
                });
            } else {
                operationalBreakdown = '0 (tidak ada biaya operasional)';
            }
            
            const totalHpp = hpp + totalOperational;
            
            // Update operational formula result
            document.getElementById('operational-formula-result').innerHTML = 
                `Total Biaya Operasional = ${operationalBreakdown} = <strong>${formatCurrency(totalOperational)}</strong>`;
            
            // Update total HPP formula result
            document.getElementById('total-hpp-formula-result').innerHTML = 
                `Total HPP = HPP (${formatCurrency(hpp)}) + Total Biaya Operasional (${formatCurrency(totalOperational)}) = <strong>${formatCurrency(totalHpp)}</strong>`;
            
            // Store total HPP globally for later use
            window.calculatedTotalHPP = totalHpp;
            
            return totalHpp;
        }

        function calculateGrossProfit() {
            // Get bruto value
            const brutoValue = document.getElementById('bruto').value.replace(/\./g, '');
            const bruto = parseFloat(brutoValue) || 0;
            
            // Calculate total HPP
            const totalHpp = calculateOperational();
            
            // Calculate gross profit
            const grossProfit = bruto - totalHpp;
            
            // Update gross profit formula result
            document.getElementById('gross-profit-formula-result').innerHTML = 
                `Laba Kotor = Bruto (${formatCurrency(bruto)}) - Total HPP (${formatCurrency(totalHpp)}) = <strong>${formatCurrency(grossProfit)}</strong>`;
            
            // Store gross profit globally for later use
            window.calculatedGrossProfit = grossProfit;
            
            return grossProfit;
        }

        function calculateNetProfit() {
            // Check if tax has been calculated
            if (window.calculatedTotalTax === undefined) {
                showNotification('Hitung biaya pajak terlebih dahulu', 'error');
                return;
            }
            
            // Calculate gross profit
            const grossProfit = calculateGrossProfit();
            
            // Get product info
            const productName = document.getElementById('product-name').value;
            const productBrand = document.getElementById('product-brand').value || '-';
            
            // Get bruto value
            const brutoValue = document.getElementById('bruto').value.replace(/\./g, '');
            const bruto = parseFloat(brutoValue) || 0;
            
            // Calculate net profit
            const netProfit = grossProfit - window.calculatedTotalTax;
            
            // Update net profit formula result
            document.getElementById('net-profit-formula-result').innerHTML = 
                `Laba Bersih = Laba Kotor (${formatCurrency(grossProfit)}) - Total Pajak (${formatCurrency(window.calculatedTotalTax)}) = <strong>${formatCurrency(netProfit)}</strong>`;
            
            // Update final result card
            document.getElementById('final-product-name').textContent = productName;
            document.getElementById('final-product-brand').textContent = productBrand;
            document.getElementById('final-bruto').textContent = formatCurrency(bruto);
            document.getElementById('final-total-hpp').textContent = formatCurrency(window.calculatedTotalHPP);
            
            // Set color for gross profit
            const grossProfitElement = document.getElementById('final-gross-profit');
            grossProfitElement.textContent = formatCurrency(grossProfit);
            if (grossProfit > 0) {
                grossProfitElement.className = 'value-shape positive';
            } else if (grossProfit < 0) {
                grossProfitElement.className = 'value-shape negative';
            } else {
                grossProfitElement.className = 'value-shape neutral';
            }
            
            document.getElementById('final-total-tax').textContent = formatCurrency(window.calculatedTotalTax);
            
            // Set color for net profit
            const netProfitElement = document.getElementById('final-net-profit');
            netProfitElement.textContent = formatCurrency(netProfit);
            if (netProfit > 0) {
                netProfitElement.className = 'value-shape positive';
            } else if (netProfit < 0) {
                netProfitElement.className = 'value-shape negative';
            } else {
                netProfitElement.className = 'value-shape neutral';
            }
            
            document.getElementById('calculation-date').textContent = new Date().toLocaleString('id-ID');
            
            // Show final result card with animation
            const finalResultCard = document.getElementById('final-result-card');
            finalResultCard.style.display = 'block';
            finalResultCard.style.opacity = '0';
            finalResultCard.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                finalResultCard.style.opacity = '1';
                finalResultCard.style.transform = 'translateY(0)';
            }, 100);
            
            // Add chart
            addChart();
            
            // Save to history
            saveToHistory();
            
            // Clear input and tax-profit data
            clearInputData();
            clearTaxProfitData();
            
            // Switch to visual tab
            const visualTab = new bootstrap.Tab(document.getElementById('visual-tab'));
            visualTab.show();
            
            showNotification('Perhitungan laba bersih berhasil', 'success');
        }

        function clearInputData() {
            // Clear product information
            document.getElementById('product-name').value = '';
            document.getElementById('product-brand').value = '';
            document.getElementById('bruto').value = '';
            document.getElementById('hpp').value = '';
            
            // Clear operational costs
            const operationalContainer = document.getElementById('operational-costs');
            operationalContainer.innerHTML = `
                <div class="empty-state" style="padding: 1.5rem 0;">
                    <i class="bi bi-inbox" style="font-size: 2rem;"></i>
                    <p>Belum ada biaya operasional</p>
                </div>
            `;
        }

        function clearTaxProfitData() {
            // Clear tax costs
            const taxContainer = document.getElementById('tax-costs');
            taxContainer.innerHTML = `
                <div class="empty-state" style="padding: 1.5rem 0;">
                    <i class="bi bi-receipt" style="font-size: 2rem;"></i>
                    <p>Belum ada biaya pajak</p>
                </div>
            `;
            
            // Clear tax calculation details
            document.getElementById('tax-calculation-details').innerHTML = `
                <div class="empty-state">
                    <i class="bi bi-calculator"></i>
                    <p>Hitung biaya pajak terlebih dahulu</p>
                </div>
            `;
            
            // Hide profit calculation steps
            document.getElementById('profit-calculation-steps').style.display = 'none';
            
            // Clear global variables
            window.calculatedTotalTax = undefined;
            window.calculatedTotalHPP = undefined;
            window.calculatedGrossProfit = undefined;
        }

        function addChart() {
            const brutoValue = document.getElementById('bruto').value.replace(/\./g, '');
            const bruto = parseFloat(brutoValue) || 0;
            
            const hppValue = document.getElementById('hpp').value.replace(/\./g, '');
            const hpp = parseFloat(hppValue) || 0;
            
            const totalOperational = window.calculatedTotalHPP - hpp || 0;
            const grossProfit = window.calculatedGrossProfit || 0;
            const totalTax = window.calculatedTotalTax || 0;
            const netProfit = grossProfit - totalTax || 0;
            
            const chartContainer = document.getElementById('chart-container');
            chartContainer.innerHTML = `
                <div class="chart-container">
                    <canvas id="financeChart"></canvas>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FF6384;"></div>
                        <span>HPP</span>
                        <span class="legend-value">${formatCurrency(hpp)}</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #36A2EB;"></div>
                        <span>Biaya Operasional</span>
                        <span class="legend-value">${formatCurrency(totalOperational)}</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FFCE56;"></div>
                        <span>Pajak</span>
                        <span class="legend-value">${formatCurrency(totalTax)}</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #4BC0C0;"></div>
                        <span>Laba Bersih</span>
                        <span class="legend-value">${formatCurrency(netProfit)}</span>
                    </div>
                </div>
            `;
            
            // Simple chart using Chart.js
            const ctx = document.getElementById('financeChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['HPP', 'Biaya Operasional', 'Pajak', 'Laba Bersih'],
                    datasets: [{
                        data: [hpp, totalOperational, totalTax, netProfit],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0'
                        ],
                        hoverBackgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = formatCurrency(context.raw);
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((context.raw / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });
        }

        function printResults() {
            const productName = document.getElementById('final-product-name').textContent;
            const productBrand = document.getElementById('final-product-brand').textContent;
            
            const bruto = document.getElementById('final-bruto').textContent;
            const totalHpp = document.getElementById('final-total-hpp').textContent;
            const grossProfit = document.getElementById('final-gross-profit').textContent;
            const totalTax = document.getElementById('final-total-tax').textContent;
            const netProfit = document.getElementById('final-net-profit').textContent;
            const calculationDate = document.getElementById('calculation-date').textContent;
            
            // Get company profile
            const companyProfile = JSON.parse(localStorage.getItem('companyProfile') || '{}');
            
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>Cetak Hasil Perhitungan</title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
                        
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        
                        body { 
                            font-family: 'Inter', sans-serif;
                            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                            color: #2c3e50;
                            padding: 0;
                            margin: 0;
                            line-height: 1.6;
                        }
                        
                        .report-container {
                            max-width: 800px;
                            margin: 0 auto;
                            padding: 40px 20px;
                        }
                        
                        .company-header {
                            text-align: center;
                            margin-bottom: 40px;
                            padding-bottom: 30px;
                            border-bottom: 2px solid #dee2e6;
                        }
                        
                        .company-logo {
                            width: 120px;
                            height: 120px;
                            margin: 0 auto 20px;
                            border-radius: 10px;
                            overflow: hidden;
                            background-color: white;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                        }
                        
                        .company-logo img {
                            max-width: 100%;
                            max-height: 100%;
                            object-fit: contain;
                        }
                        
                        .company-logo i {
                            font-size: 3rem;
                            color: #dee2e6;
                        }
                        
                        .company-name {
                            font-size: 28px;
                            font-weight: 700;
                            color: var(--primary-color);
                            margin: 0 0 5px;
                        }
                        
                        .company-tagline {
                            font-size: 16px;
                            color: #6c757d;
                            margin: 0 0 15px;
                            font-style: italic;
                        }
                        
                        .company-info {
                            display: flex;
                            justify-content: center;
                            flex-wrap: wrap;
                            gap: 15px;
                            margin-bottom: 10px;
                        }
                        
                        .company-info-item {
                            display: flex;
                            align-items: center;
                            font-size: 14px;
                            color: #495057;
                        }
                        
                        .company-info-item i {
                            margin-right: 5px;
                            color: var(--primary-color);
                        }
                        
                        .company-social {
                            display: flex;
                            justify-content: center;
                            gap: 10px;
                            margin-top: 10px;
                        }
                        
                        .company-social a {
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            width: 30px;
                            height: 30px;
                            border-radius: 50%;
                            background-color: #f8f9fa;
                            color: var(--primary-color);
                            text-decoration: none;
                        }
                        
                        .report-header {
                            text-align: center;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 2px solid #dee2e6;
                        }
                        
                        .report-title {
                            font-size: 24px;
                            font-weight: 700;
                            color: var(--primary-color);
                            margin: 0 0 10px;
                        }
                        
                        .report-subtitle {
                            font-size: 16px;
                            color: #6c757d;
                            margin: 0;
                        }
                        
                        .animated-date-badge {
                            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                            color: white;
                            border-radius: 30px;
                            padding: 0.5rem 1rem;
                            font-size: 0.9rem;
                            font-weight: 600;
                            display: inline-flex;
                            align-items: center;
                            box-shadow: 0 4px 10px rgba(255, 126, 0, 0.3);
                            position: relative;
                            overflow: hidden;
                            z-index: 1;
                            animation: float 3s ease-in-out infinite;
                        }
                        
                        .animated-date-badge::before {
                            content: '';
                            position: absolute;
                            top: -50%;
                            left: -50%;
                            width: 200%;
                            height: 200%;
                            background: linear-gradient(
                                to bottom right,
                                rgba(255, 255, 255, 0.3),
                                rgba(255, 255, 255, 0.1)
                            );
                            transform: rotate(45deg);
                            z-index: -1;
                            animation: shine 3s infinite;
                        }
                        
                        .animated-date-badge i {
                            margin-right: 0.5rem;
                            font-size: 1rem;
                            animation: pulse-icon 2s infinite;
                        }
                        
                        .product-card {
                            background: white;
                            border-radius: 16px;
                            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
                            overflow: hidden;
                            margin-bottom: 40px;
                            transition: transform 0.3s ease;
                        }
                        
                        .product-card:hover {
                            transform: translateY(-5px);
                        }
                        
                        .product-header {
                            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                            color: white;
                            padding: 20px;
                            position: relative;
                        }
                        
                        .product-title {
                            font-size: 24px;
                            font-weight: 700;
                            margin: 0;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }
                        
                        .product-title i {
                            font-size: 20px;
                        }
                        
                        .product-subtitle {
                            font-size: 16px;
                            opacity: 0.9;
                            margin-top: 5px;
                        }
                        
                        .product-body {
                            padding: 30px;
                        }
                        
                        .result-row {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 15px 0;
                            border-bottom: 1px dashed #e9ecef;
                            transition: all 0.2s ease;
                        }
                        
                        .result-row:hover {
                            background-color: #f8f9fa;
                            margin: 0 -30px;
                            padding: 15px 30px;
                        }
                        
                        .result-row:last-child {
                            border-bottom: none;
                            font-size: 18px;
                            font-weight: 600;
                            margin-top: 10px;
                            padding-top: 20px;
                            border-top: 2px solid #e9ecef;
                        }
                        
                        .result-row:last-child:hover {
                            background-color: transparent;
                        }
                        
                        .result-label {
                            font-weight: 500;
                            color: #495057;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        }
                        
                        .result-label i {
                            color: var(--primary-color);
                            font-size: 16px;
                        }
                        
                        .result-value {
                            font-weight: 600;
                            text-align: right;
                        }
                        
                        .value-shape {
                            position: relative;
                            display: inline-block;
                            padding: 0.25rem 0.75rem;
                            border-radius: 20px;
                            font-weight: 600;
                        }
                        
                        .value-shape.positive {
                            background-color: rgba(10, 135, 84, 0.1);
                            color: var(--success-color);
                        }
                        
                        .value-shape.negative {
                            background-color: rgba(196, 30, 58, 0.1);
                            color: var(--danger-color);
                        }
                        
                        .value-shape.neutral {
                            background-color: rgba(44, 62, 80, 0.1);
                            color: var(--dark-color);
                        }
                        
                        .footer {
                            text-align: center;
                            margin-top: 50px;
                            padding-top: 20px;
                            border-top: 1px solid #dee2e6;
                            font-size: 12px;
                            color: #6c757d;
                        }
                        
                        .footer p {
                            margin: 5px 0;
                        }
                        
                        .watermark {
                            position: fixed;
                            bottom: 20px;
                            right: 20px;
                            opacity: 0.1;
                            font-size: 14px;
                            color: #2c3e50;
                            transform: rotate(-15deg);
                        }
                        
                        @keyframes float {
                            0%, 100% {
                                transform: translateY(0);
                            }
                            50% {
                                transform: translateY(-5px);
                            }
                        }
                        
                        @keyframes shine {
                            0% {
                                transform: translateX(-100%) translateY(-100%) rotate(45deg);
                            }
                            100% {
                                transform: translateX(100%) translateY(100%) rotate(45deg);
                            }
                        }
                        
                        @keyframes pulse-icon {
                            0%, 100% {
                                transform: scale(1);
                            }
                            50% {
                                transform: scale(1.2);
                            }
                        }
                        
                        @media print {
                            body {
                                background: white;
                                padding: 0;
                            }
                            
                            .report-container {
                                padding: 30px 20px;
                                max-width: 100%;
                            }
                            
                            .product-card {
                                box-shadow: none;
                                border: 1px solid #dee2e6;
                            }
                            
                            .watermark {
                                display: none;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="report-container">
                        ${companyProfile.name || companyProfile.tagline ? `
                        <div class="company-header">
                            ${companyProfile.logo ? `
                            <div class="company-logo">
                                <img src="${companyProfile.logo}" alt="${companyProfile.name || 'Logo Perusahaan'}">
                            </div>
                            ` : ''}
                            ${companyProfile.name ? `<h1 class="company-name">${companyProfile.name}</h1>` : ''}
                            ${companyProfile.tagline ? `<p class="company-tagline">${companyProfile.tagline}</p>` : ''}
                            
                            <div class="company-info">
                                ${companyProfile.established ? `
                                <div class="company-info-item">
                                    <i class="bi bi-calendar-event"></i>
                                    <span>Berdiri: ${companyProfile.established}</span>
                                </div>
                                ` : ''}
                                ${companyProfile.entity ? `
                                <div class="company-info-item">
                                    <i class="bi bi-building"></i>
                                    <span>${companyProfile.entity}</span>
                                </div>
                                ` : ''}
                                ${companyProfile.phone ? `
                                <div class="company-info-item">
                                    <i class="bi bi-telephone"></i>
                                    <span>${companyProfile.phone}</span>
                                </div>
                                ` : ''}
                                ${companyProfile.email ? `
                                <div class="company-info-item">
                                    <i class="bi bi-envelope"></i>
                                    <span>${companyProfile.email}</span>
                                </div>
                                ` : ''}
                                ${companyProfile.website ? `
                                <div class="company-info-item">
                                    <i class="bi bi-globe"></i>
                                    <span>${companyProfile.website}</span>
                                </div>
                                ` : ''}
                            </div>
                            
                            ${(companyProfile.instagram || companyProfile.facebook || companyProfile.tiktok || 
                              companyProfile.twitter || companyProfile.youtube || companyProfile.linkedin) ? `
                            <div class="company-social">
                                ${companyProfile.instagram ? `<a href="${companyProfile.instagram.startsWith('http') ? companyProfile.instagram : 'https://instagram.com/' + companyProfile.instagram}" target="_blank"><i class="bi bi-instagram"></i></a>` : ''}
                                ${companyProfile.facebook ? `<a href="${companyProfile.facebook.startsWith('http') ? companyProfile.facebook : 'https://facebook.com/' + companyProfile.facebook}" target="_blank"><i class="bi bi-facebook"></i></a>` : ''}
                                ${companyProfile.tiktok ? `<a href="${companyProfile.tiktok.startsWith('http') ? companyProfile.tiktok : 'https://tiktok.com/@' + companyProfile.tiktok}" target="_blank"><i class="bi bi-tiktok"></i></a>` : ''}
                                ${companyProfile.twitter ? `<a href="${companyProfile.twitter.startsWith('http') ? companyProfile.twitter : 'https://twitter.com/' + companyProfile.twitter}" target="_blank"><i class="bi bi-twitter"></i></a>` : ''}
                                ${companyProfile.youtube ? `<a href="${companyProfile.youtube.startsWith('http') ? companyProfile.youtube : 'https://youtube.com/' + companyProfile.youtube}" target="_blank"><i class="bi bi-youtube"></i></a>` : ''}
                                ${companyProfile.linkedin ? `<a href="${companyProfile.linkedin.startsWith('http') ? companyProfile.linkedin : 'https://linkedin.com/company/' + companyProfile.linkedin}" target="_blank"><i class="bi bi-linkedin"></i></a>` : ''}
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}
                        
                        <div class="report-header">
                            <h2 class="report-title">LAPORAN HASIL PERHITUNGAN KEUANGAN</h2>
                            <p class="report-subtitle">Penghitung Keuangan</p>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 30px;">
                            <div class="animated-date-badge">
                                <i class="bi bi-calendar-event"></i> 
                                ${new Date().toLocaleString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                            </div>
                        </div>
                        
                        <div class="product-card">
                            <div class="product-header">
                                <h3 class="product-title">
                                    <i class="bi bi-box-seam"></i>
                                    ${productName}
                                </h3>
                                <p class="product-subtitle">${productBrand}</p>
                            </div>
                            <div class="product-body">
                                <div class="result-row">
                                    <span class="result-label">
                                        <i class="bi bi-cash-stack"></i>
                                        Bruto
                                    </span>
                                    <span class="value-shape neutral">${bruto}</span>
                                </div>
                                <div class="result-row">
                                    <span class="result-label">
                                        <i class="bi bi-wallet2"></i>
                                        Total HPP
                                    </span>
                                    <span class="value-shape neutral">${totalHpp}</span>
                                </div>
                                <div class="result-row">
                                    <span class="result-label">
                                        <i class="bi bi-graph-up-arrow"></i>
                                        Laba Kotor
                                    </span>
                                    <span class="value-shape ${grossProfit.includes('Rp 0') ? 'neutral' : (grossProfit.includes('-') ? 'negative' : 'positive')}">${grossProfit}</span>
                                </div>
                                <div class="result-row">
                                    <span class="result-label">
                                        <i class="bi bi-receipt"></i>
                                        Total Pajak
                                    </span>
                                    <span class="value-shape neutral">${totalTax}</span>
                                </div>
                                <div class="result-row">
                                    <span class="result-label">
                                        <i class="bi bi-piggy-bank"></i>
                                        Laba Bersih
                                    </span>
                                    <span class="value-shape ${netProfit.includes('Rp 0') ? 'neutral' : (netProfit.includes('-') ? 'negative' : 'positive')}">${netProfit}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="footer">
                            <p>Laporan ini dicetak melalui Aplikasi Penghitung Keuangan</p>
                            <p>© ${new Date().getFullYear()} Penghitung Keuangan. Hak Cipta Dilindungi.</p>
                        </div>
                    </div>
                    
                    <div class="watermark">Penghitung Keuangan</div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
            
            showNotification('Dokumen siap dicetak', 'success');
        }

        function saveToHistory() {
            const productName = document.getElementById('product-name').value;
            const productBrand = document.getElementById('product-brand').value || '-';
            
            const brutoValue = document.getElementById('bruto').value.replace(/\./g, '');
            const hppValue = document.getElementById('hpp').value.replace(/\./g, '');
            
            const historyItem = {
                productName: productName,
                productBrand: productBrand,
                bruto: brutoValue,
                hpp: hppValue,
                grossProfit: window.calculatedGrossProfit || 0,
                totalTax: window.calculatedTotalTax || 0,
                netProfit: parseFloat(document.getElementById('final-net-profit').textContent.replace(/[Rp., ]/g, '')) || 0,
                date: new Date().toISOString()
            };
            
            let history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            history.unshift(historyItem);
            
            // Keep only last 50 calculations
            if (history.length > 50) history = history.slice(0, 50);
            
            localStorage.setItem('calculationHistory', JSON.stringify(history));
            updateHistoryDisplay();
            updatePrintHistoryDisplay();
            updateReportSummary();
        }

        function updateHistoryDisplay() {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            updateHistoryDisplayWithSortedData(history);
        }

        function updateHistoryDisplayWithSortedData(sortedHistory) {
            const historyContainer = document.getElementById('history-container');
            
            if (sortedHistory.length === 0) {
                historyContainer.innerHTML = '<div class="empty-state"><i class="bi bi-hourglass-split"></i><p>Belum ada riwayat perhitungan</p></div>';
                return;
            }
            
            let historyHTML = '';
            sortedHistory.forEach((item, index) => {
                // Find original index for edit/delete operations
                const originalHistory = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
                const originalIndex = originalHistory.findIndex(h => 
                    h.productName === item.productName && 
                    h.date === item.date
                );
                
                const date = new Date(item.date).toLocaleString('id-ID');
                
                // Determine profit color class
                let profitClass = 'neutral';
                if (item.netProfit > 0) profitClass = 'positive';
                else if (item.netProfit < 0) profitClass = 'negative';
                
                historyHTML += `
                    <div class="history-item" data-index="${originalIndex}" data-name="${item.productName.toLowerCase()}" data-brand="${item.productBrand.toLowerCase()}" data-profit="${item.netProfit > 0 ? 'profit' : (item.netProfit < 0 ? 'loss' : 'neutral')}">
                        <div class="history-actions">
                            <button class="btn-remove" onclick="editHistoryItem(${originalIndex})" title="Edit">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn-remove" onclick="deleteHistoryItem(${originalIndex})" title="Hapus">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                        <div class="history-header">
                            <div class="history-date-badge">
                                <i class="bi bi-calendar-event"></i> ${date}
                            </div>
                        </div>
                        <div class="history-content">
                            <div class="product-info">
                                <div class="product-name">${item.productName}</div>
                                <div class="product-brand"><i class="bi bi-tag"></i> ${item.productBrand}</div>
                            </div>
                            <div class="history-profit">
                                <div class="history-profit-label">Laba Bersih</div>
                                <div class="value-shape ${profitClass} history-net-profit">${formatCurrency(item.netProfit)}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            historyContainer.innerHTML = historyHTML;
        }

        function sortHistory(sortType) {
            // Update active state in dropdown
            const dropdownItems = document.querySelectorAll('#sortDropdown + .dropdown-menu .dropdown-item');
            dropdownItems.forEach(item => {
                if (item.getAttribute('data-sort') === sortType) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Get current time filter
            const activeTimeItem = document.querySelector('#timeFilterDropdown + .dropdown-menu .dropdown-item.active');
            const timeFilter = activeTimeItem ? activeTimeItem.getAttribute('data-time') : 'all';
            
            // Check if custom date filter is active
            const customDateContainer = document.getElementById('custom-date-container-history');
            if (customDateContainer.style.display === 'block') {
                const startDate = document.getElementById('start-date-history').value;
                const endDate = document.getElementById('end-date-history').value;
                
                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    applyHistoryFiltersWithCustomDate(start, end, sortType);
                } else {
                    applyHistoryFilters(timeFilter, sortType);
                }
            } else {
                applyHistoryFilters(timeFilter, sortType);
            }
        }

        function filterHistoryByTime(timeFilter) {
            // Update active state in dropdown
            const dropdownItems = document.querySelectorAll('#timeFilterDropdown + .dropdown-menu .dropdown-item');
            dropdownItems.forEach(item => {
                if (item.getAttribute('data-time') === timeFilter) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Show/hide custom date container based on filter
            const customDateContainer = document.getElementById('custom-date-container-history');
            if (timeFilter === 'custom') {
                customDateContainer.style.display = 'block';
                return; // Don't apply filter yet, wait for user to select dates
            } else {
                customDateContainer.style.display = 'none';
            }
            
            // Get current sort filter
            const activeSortItem = document.querySelector('#sortDropdown + .dropdown-menu .dropdown-item.active');
            const sortFilter = activeSortItem ? activeSortItem.getAttribute('data-sort') : 'all';
            
            // Apply both time and sort filters
            applyHistoryFilters(timeFilter, sortFilter);
        }

        function applyCustomDateFilterHistory() {
            const startDate = document.getElementById('start-date-history').value;
            const endDate = document.getElementById('end-date-history').value;
            
            if (!startDate || !endDate) {
                showNotification('Pilih tanggal mulai dan tanggal selesai', 'error');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start > end) {
                showNotification('Tanggal mulai tidak boleh lebih besar dari tanggal selesai', 'error');
                return;
            }
            
            // Get current sort filter
            const activeSortItem = document.querySelector('#sortDropdown + .dropdown-menu .dropdown-item.active');
            const sortFilter = activeSortItem ? activeSortItem.getAttribute('data-sort') : 'all';
            
            // Apply both custom date and sort filters
            applyHistoryFiltersWithCustomDate(start, end, sortFilter);
            
            showNotification('Filter tanggal berhasil diterapkan', 'success');
        }

        function applyHistoryFilters(timeFilter, sortFilter) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            let filteredHistory = [...history];
            const now = new Date();
            
            // Apply time filter
            switch(timeFilter) {
                case '30':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 30;
                    });
                    break;
                case '15':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 15;
                    });
                    break;
                case '7':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 7;
                    });
                    break;
                case '3':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 3;
                    });
                    break;
                case 'today':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        return itemDate.toDateString() === now.toDateString();
                    });
                    break;
                case 'all':
                default:
                    // No time filter
                    break;
            }
            
            // Apply sort filter
            applySortFilter(filteredHistory, sortFilter);
        }

        function applyHistoryFiltersWithCustomDate(startDate, endDate, sortFilter) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            let filteredHistory = history.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= startDate && itemDate <= endDate;
            });
            
            // Apply sort filter
            applySortFilter(filteredHistory, sortFilter);
        }

        function applySortFilter(historyData, sortFilter) {
            let sortedHistory = [...historyData];
            
            // Sort based on selected type
            switch(sortFilter) {
                case 'az':
                    sortedHistory.sort((a, b) => a.productName.localeCompare(b.productName));
                    break;
                case 'za':
                    sortedHistory.sort((a, b) => b.productName.localeCompare(a.productName));
                    break;
                case 'profit':
                    sortedHistory.sort((a, b) => {
                        // Sort by profit (descending) but only include profitable items
                        const aProfit = a.netProfit > 0 ? a.netProfit : -Infinity;
                        const bProfit = b.netProfit > 0 ? b.netProfit : -Infinity;
                        return bProfit - aProfit;
                    });
                    break;
                case 'loss':
                    sortedHistory.sort((a, b) => {
                        // Sort by loss (ascending) but only include loss items
                        const aLoss = a.netProfit < 0 ? Math.abs(a.netProfit) : -Infinity;
                        const bLoss = b.netProfit < 0 ? Math.abs(b.netProfit) : -Infinity;
                        return bLoss - aLoss;
                    });
                    break;
                case 'all':
                default:
                    // Default sorting (most recent first)
                    sortedHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
                    break;
            }
            
            // Update display with sorted and filtered history
            updateHistoryDisplayWithSortedData(sortedHistory);
        }

        function updatePrintHistoryDisplay() {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const printHistoryContainer = document.getElementById('print-history-container');
            
            if (history.length === 0) {
                printHistoryContainer.innerHTML = '<div class="empty-state"><i class="bi bi-printer"></i><p>Belum ada riwayat untuk dicetak</p></div>';
                return;
            }
            
            let historyHTML = '';
            history.forEach((item, index) => {
                const date = new Date(item.date).toLocaleString('id-ID');
                
                // Determine profit color class
                let profitClass = 'neutral';
                if (item.netProfit > 0) profitClass = 'positive';
                else if (item.netProfit < 0) profitClass = 'negative';
                
                historyHTML += `
                    <div class="print-history-item" data-index="${index}" data-profit="${item.netProfit > 0 ? 'profit' : (item.netProfit < 0 ? 'loss' : 'neutral')}">
                        <input type="checkbox" class="print-checkbox" id="print-item-${index}" value="${index}">
                        <div class="product-info">
                            <div class="product-name">${item.productName}</div>
                            <div class="product-brand">${item.productBrand}</div>
                            <div class="history-date-shape">
                                <i class="bi bi-calendar-event"></i> ${date}
                            </div>
                        </div>
                        <div class="history-values">
                            <div class="value-shape ${profitClass} history-net-profit">${formatCurrency(item.netProfit)}</div>
                        </div>
                    </div>
                `;
            });
            
            printHistoryContainer.innerHTML = historyHTML;
        }

        function updateReportSummary() {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            
            // Calculate totals
            let totalTransactions = history.length;
            let totalBruto = 0;
            let totalHpp = 0;
            let totalGrossProfit = 0;
            let totalTax = 0;
            let totalNetProfit = 0;
            
            history.forEach(item => {
                totalBruto += parseFloat(item.bruto) || 0;
                totalHpp += parseFloat(item.hpp) || 0;
                totalGrossProfit += item.grossProfit || 0;
                totalTax += item.totalTax || 0;
                totalNetProfit += item.netProfit || 0;
            });
            
            // Update display
            document.getElementById('total-transactions').textContent = totalTransactions;
            document.getElementById('total-bruto-report').textContent = formatCurrency(totalBruto);
            document.getElementById('total-hpp-report').textContent = formatCurrency(totalHpp);
            document.getElementById('total-gross-profit-report').textContent = formatCurrency(totalGrossProfit);
            document.getElementById('total-tax-report').textContent = formatCurrency(totalTax);
            
            // Set color for total net profit
            const totalNetProfitElement = document.getElementById('total-net-profit-report');
            totalNetProfitElement.textContent = formatCurrency(totalNetProfit);
            if (totalNetProfit > 0) {
                totalNetProfitElement.className = 'value-shape positive';
            } else if (totalNetProfit < 0) {
                totalNetProfitElement.className = 'value-shape negative';
            } else {
                totalNetProfitElement.className = 'value-shape neutral';
            }
        }

        function filterReportSummaryByDate(filter) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            let filteredHistory = [...history];
            const now = new Date();
            
            switch(filter) {
                case '30':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 30;
                    });
                    break;
                case '15':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 15;
                    });
                    break;
                case '7':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 7;
                    });
                    break;
                case '3':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 3;
                    });
                    break;
                case 'today':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        return itemDate.toDateString() === now.toDateString();
                    });
                    break;
            }
            
            // Calculate totals for filtered history
            let totalTransactions = filteredHistory.length;
            let totalBruto = 0;
            let totalHpp = 0;
            let totalGrossProfit = 0;
            let totalTax = 0;
            let totalNetProfit = 0;
            
            filteredHistory.forEach(item => {
                totalBruto += parseFloat(item.bruto) || 0;
                totalHpp += parseFloat(item.hpp) || 0;
                totalGrossProfit += item.grossProfit || 0;
                totalTax += item.totalTax || 0;
                totalNetProfit += item.netProfit || 0;
            });
            
            // Update display
            document.getElementById('total-transactions').textContent = totalTransactions;
            document.getElementById('total-bruto-report').textContent = formatCurrency(totalBruto);
            document.getElementById('total-hpp-report').textContent = formatCurrency(totalHpp);
            document.getElementById('total-gross-profit-report').textContent = formatCurrency(totalGrossProfit);
            document.getElementById('total-tax-report').textContent = formatCurrency(totalTax);
            
            // Set color for total net profit
            const totalNetProfitElement = document.getElementById('total-net-profit-report');
            totalNetProfitElement.textContent = formatCurrency(totalNetProfit);
            if (totalNetProfit > 0) {
                totalNetProfitElement.className = 'value-shape positive';
            } else if (totalNetProfit < 0) {
                totalNetProfitElement.className = 'value-shape negative';
            } else {
                totalNetProfitElement.className = 'value-shape neutral';
            }
        }

        function filterReportSummaryByProfit(profitFilter) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            let filteredHistory = [...history];
            
            if (profitFilter === 'profit') {
                filteredHistory = history.filter(item => item.netProfit > 0);
            } else if (profitFilter === 'loss') {
                filteredHistory = history.filter(item => item.netProfit < 0);
            }
            
            // Calculate totals for filtered history
            let totalTransactions = filteredHistory.length;
            let totalBruto = 0;
            let totalHpp = 0;
            let totalGrossProfit = 0;
            let totalTax = 0;
            let totalNetProfit = 0;
            
            filteredHistory.forEach(item => {
                totalBruto += parseFloat(item.bruto) || 0;
                totalHpp += parseFloat(item.hpp) || 0;
                totalGrossProfit += item.grossProfit || 0;
                totalTax += item.totalTax || 0;
                totalNetProfit += item.netProfit || 0;
            });
            
            // Update display
            document.getElementById('total-transactions').textContent = totalTransactions;
            document.getElementById('total-bruto-report').textContent = formatCurrency(totalBruto);
            document.getElementById('total-hpp-report').textContent = formatCurrency(totalHpp);
            document.getElementById('total-gross-profit-report').textContent = formatCurrency(totalGrossProfit);
            document.getElementById('total-tax-report').textContent = formatCurrency(totalTax);
            
            // Set color for total net profit
            const totalNetProfitElement = document.getElementById('total-net-profit-report');
            totalNetProfitElement.textContent = formatCurrency(totalNetProfit);
            if (totalNetProfit > 0) {
                totalNetProfitElement.className = 'value-shape positive';
            } else if (totalNetProfit < 0) {
                totalNetProfitElement.className = 'value-shape negative';
            } else {
                totalNetProfitElement.className = 'value-shape neutral';
            }
        }

        function displayAllHistoryItems() {
            const historyItems = document.querySelectorAll('#history-container .history-item');
            historyItems.forEach(item => {
                item.style.display = 'flex';
            });
        }

        function searchProducts(searchTerm) {
            const historyItems = document.querySelectorAll('#history-container .history-item');
            
            if (searchTerm.trim() === '') {
                // If search term is empty, show all items
                displayAllHistoryItems();
                return;
            }
            
            const lowerCaseSearchTerm = searchTerm.toLowerCase();
            
            historyItems.forEach(item => {
                const productName = item.getAttribute('data-name');
                
                if (productName.includes(lowerCaseSearchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function searchBrands(searchTerm) {
            const historyItems = document.querySelectorAll('#history-container .history-item');
            
            if (searchTerm.trim() === '') {
                // If search term is empty, show all items
                displayAllHistoryItems();
                return;
            }
            
            const lowerCaseSearchTerm = searchTerm.toLowerCase();
            
            historyItems.forEach(item => {
                const brandName = item.getAttribute('data-brand');
                
                if (brandName.includes(lowerCaseSearchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function filterPrintByTime(timeFilter) {
            // Update active state in dropdown
            const dropdownItems = document.querySelectorAll('#printTimeFilterDropdown + .dropdown-menu .dropdown-item');
            dropdownItems.forEach(item => {
                if (item.getAttribute('data-time') === timeFilter) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Show/hide custom date container based on filter
            const customDateContainer = document.getElementById('custom-date-container-print');
            if (timeFilter === 'custom') {
                customDateContainer.style.display = 'block';
                return; // Don't apply filter yet, wait for user to select dates
            } else {
                customDateContainer.style.display = 'none';
            }
            
            // Get current profit filter
            const activeProfitItem = document.querySelector('#printProfitFilterDropdown + .dropdown-menu .dropdown-item.active');
            const profitFilter = activeProfitItem ? activeProfitItem.getAttribute('data-profit') : 'all';
            
            // Apply both time and profit filters
            filterHistoryByDateAndProfitPrint(timeFilter, profitFilter);
        }

        function filterPrintByProfit(profitFilter) {
            // Update active state in dropdown
            const dropdownItems = document.querySelectorAll('#printProfitFilterDropdown + .dropdown-menu .dropdown-item');
            dropdownItems.forEach(item => {
                if (item.getAttribute('data-profit') === profitFilter) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Get current time filter
            const activeTimeItem = document.querySelector('#printTimeFilterDropdown + .dropdown-menu .dropdown-item.active');
            const timeFilter = activeTimeItem ? activeTimeItem.getAttribute('data-time') : 'all';
            
            // Check if custom date filter is active
            const customDateContainer = document.getElementById('custom-date-container-print');
            if (customDateContainer.style.display === 'block') {
                const startDate = document.getElementById('start-date-print').value;
                const endDate = document.getElementById('end-date-print').value;
                
                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    applyPrintFiltersWithCustomDate(start, end, profitFilter);
                } else {
                    filterHistoryByDateAndProfitPrint(timeFilter, profitFilter);
                }
            } else {
                filterHistoryByDateAndProfitPrint(timeFilter, profitFilter);
            }
        }

        function filterHistoryByDatePrint(filter) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const printHistoryContainer = document.getElementById('print-history-container');
            
            if (history.length === 0) {
                printHistoryContainer.innerHTML = '<div class="empty-state"><i class="bi bi-printer"></i><p>Belum ada riwayat untuk dicetak</p></div>';
                return;
            }
            
            let filteredHistory = [...history];
            const now = new Date();
            
            switch(filter) {
                case '30':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 30;
                    });
                    break;
                case '15':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 15;
                    });
                    break;
                case '7':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 7;
                    });
                    break;
                case '3':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 3;
                    });
                    break;
                case 'today':
                    filteredHistory = history.filter(item => {
                        const itemDate = new Date(item.date);
                        return itemDate.toDateString() === now.toDateString();
                    });
                    break;
            }
            
            let historyHTML = '';
            filteredHistory.forEach((item) => {
                const date = new Date(item.date).toLocaleString('id-ID');
                
                // Determine profit color class
                let profitClass = 'neutral';
                if (item.netProfit > 0) profitClass = 'positive';
                else if (item.netProfit < 0) profitClass = 'negative';
                
                // Find original index
                const originalIndex = history.findIndex(h => 
                    h.productName === item.productName && 
                    h.date === item.date
                );
                
                historyHTML += `
                    <div class="print-history-item" data-index="${originalIndex}" data-profit="${item.netProfit > 0 ? 'profit' : (item.netProfit < 0 ? 'loss' : 'neutral')}">
                        <input type="checkbox" class="print-checkbox" id="print-item-${originalIndex}" value="${originalIndex}">
                        <div class="product-info">
                            <div class="product-name">${item.productName}</div>
                            <div class="product-brand">${item.productBrand}</div>
                            <div class="history-date-shape">
                                <i class="bi bi-calendar-event"></i> ${date}
                            </div>
                        </div>
                        <div class="history-values">
                            <div class="value-shape ${profitClass} history-net-profit">${formatCurrency(item.netProfit)}</div>
                        </div>
                    </div>
                `;
            });
            
            if (historyHTML === '') {
                historyHTML = '<div class="empty-state"><i class="bi bi-printer"></i><p>Tidak ada riwayat untuk periode ini</p></div>';
            }
            
            printHistoryContainer.innerHTML = historyHTML;
        }

        function filterHistoryByDateAndProfitPrint(dateFilter, profitFilter) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const printHistoryContainer = document.getElementById('print-history-container');
            
            if (history.length === 0) {
                printHistoryContainer.innerHTML = '<div class="empty-state"><i class="bi bi-printer"></i><p>Belum ada riwayat untuk dicetak</p></div>';
                return;
            }
            
            let filteredHistory = [...history];
            const now = new Date();
            
            // Apply date filter
            if (dateFilter !== 'all') {
                switch(dateFilter) {
                    case '30':
                        filteredHistory = filteredHistory.filter(item => {
                            const itemDate = new Date(item.date);
                            const diffTime = Math.abs(now - itemDate);
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            return diffDays <= 30;
                        });
                        break;
                    case '15':
                        filteredHistory = filteredHistory.filter(item => {
                            const itemDate = new Date(item.date);
                            const diffTime = Math.abs(now - itemDate);
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            return diffDays <= 15;
                        });
                        break;
                    case '7':
                        filteredHistory = filteredHistory.filter(item => {
                            const itemDate = new Date(item.date);
                            const diffTime = Math.abs(now - itemDate);
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            return diffDays <= 7;
                        });
                        break;
                    case '3':
                        filteredHistory = filteredHistory.filter(item => {
                            const itemDate = new Date(item.date);
                            const diffTime = Math.abs(now - itemDate);
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            return diffDays <= 3;
                        });
                        break;
                    case 'today':
                        filteredHistory = filteredHistory.filter(item => {
                            const itemDate = new Date(item.date);
                            return itemDate.toDateString() === now.toDateString();
                        });
                        break;
                }
            }
            
            // Apply profit filter
            if (profitFilter === 'profit') {
                filteredHistory = filteredHistory.filter(item => item.netProfit > 0);
            } else if (profitFilter === 'loss') {
                filteredHistory = filteredHistory.filter(item => item.netProfit < 0);
            }
            
            let historyHTML = '';
            filteredHistory.forEach((item) => {
                const date = new Date(item.date).toLocaleString('id-ID');
                
                // Determine profit color class
                let profitClass = 'neutral';
                if (item.netProfit > 0) profitClass = 'positive';
                else if (item.netProfit < 0) profitClass = 'negative';
                
                // Find original index
                const originalIndex = history.findIndex(h => 
                    h.productName === item.productName && 
                    h.date === item.date
                );
                
                historyHTML += `
                    <div class="print-history-item" data-index="${originalIndex}" data-profit="${item.netProfit > 0 ? 'profit' : (item.netProfit < 0 ? 'loss' : 'neutral')}">
                        <input type="checkbox" class="print-checkbox" id="print-item-${originalIndex}" value="${originalIndex}">
                        <div class="product-info">
                            <div class="product-name">${item.productName}</div>
                            <div class="product-brand">${item.productBrand}</div>
                            <div class="history-date-shape">
                                <i class="bi bi-calendar-event"></i> ${date}
                            </div>
                        </div>
                        <div class="history-values">
                            <div class="value-shape ${profitClass} history-net-profit">${formatCurrency(item.netProfit)}</div>
                        </div>
                    </div>
                `;
            });
            
            if (historyHTML === '') {
                historyHTML = '<div class="empty-state"><i class="bi bi-printer"></i><p>Tidak ada riwayat untuk periode ini</p></div>';
            }
            
            printHistoryContainer.innerHTML = historyHTML;
        }

        function applyPrintFiltersWithCustomDate(startDate, endDate, profitFilter) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const printHistoryContainer = document.getElementById('print-history-container');
            
            if (history.length === 0) {
                printHistoryContainer.innerHTML = '<div class="empty-state"><i class="bi bi-printer"></i><p>Belum ada riwayat untuk dicetak</p></div>';
                return;
            }
            
            let filteredHistory = history.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= startDate && itemDate <= endDate;
            });
            
            // Apply profit filter
            if (profitFilter === 'profit') {
                filteredHistory = filteredHistory.filter(item => item.netProfit > 0);
            } else if (profitFilter === 'loss') {
                filteredHistory = filteredHistory.filter(item => item.netProfit < 0);
            }
            
            let historyHTML = '';
            filteredHistory.forEach((item) => {
                const date = new Date(item.date).toLocaleString('id-ID');
                
                // Determine profit color class
                let profitClass = 'neutral';
                if (item.netProfit > 0) profitClass = 'positive';
                else if (item.netProfit < 0) profitClass = 'negative';
                
                // Find original index
                const originalIndex = history.findIndex(h => 
                    h.productName === item.productName && 
                    h.date === item.date
                );
                
                historyHTML += `
                    <div class="print-history-item" data-index="${originalIndex}" data-profit="${item.netProfit > 0 ? 'profit' : (item.netProfit < 0 ? 'loss' : 'neutral')}">
                        <input type="checkbox" class="print-checkbox" id="print-item-${originalIndex}" value="${originalIndex}">
                        <div class="product-info">
                            <div class="product-name">${item.productName}</div>
                            <div class="product-brand">${item.productBrand}</div>
                            <div class="history-date-shape">
                                <i class="bi bi-calendar-event"></i> ${date}
                            </div>
                        </div>
                        <div class="history-values">
                            <div class="value-shape ${profitClass} history-net-profit">${formatCurrency(item.netProfit)}</div>
                        </div>
                    </div>
                `;
            });
            
            if (historyHTML === '') {
                historyHTML = '<div class="empty-state"><i class="bi bi-printer"></i><p>Tidak ada riwayat untuk periode ini</p></div>';
            }
            
            printHistoryContainer.innerHTML = historyHTML;
            showNotification('Filter tanggal berhasil diterapkan', 'success');
        }

        function applyCustomDateFilterReport() {
            const startDate = document.getElementById('start-date-report').value;
            const endDate = document.getElementById('end-date-report').value;
            
            if (!startDate || !endDate) {
                showNotification('Pilih tanggal mulai dan tanggal selesai', 'error');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start > end) {
                showNotification('Tanggal mulai tidak boleh lebih besar dari tanggal selesai', 'error');
                return;
            }
            
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            let filteredHistory = history.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= start && itemDate <= end;
            });
            
            // Calculate totals for filtered history
            let totalTransactions = filteredHistory.length;
            let totalBruto = 0;
            let totalHpp = 0;
            let totalGrossProfit = 0;
            let totalTax = 0;
            let totalNetProfit = 0;
            
            filteredHistory.forEach(item => {
                totalBruto += parseFloat(item.bruto) || 0;
                totalHpp += parseFloat(item.hpp) || 0;
                totalGrossProfit += item.grossProfit || 0;
                totalTax += item.totalTax || 0;
                totalNetProfit += item.netProfit || 0;
            });
            
            // Update display
            document.getElementById('total-transactions').textContent = totalTransactions;
            document.getElementById('total-bruto-report').textContent = formatCurrency(totalBruto);
            document.getElementById('total-hpp-report').textContent = formatCurrency(totalHpp);
            document.getElementById('total-gross-profit-report').textContent = formatCurrency(totalGrossProfit);
            document.getElementById('total-tax-report').textContent = formatCurrency(totalTax);
            
            // Set color for total net profit
            const totalNetProfitElement = document.getElementById('total-net-profit-report');
            totalNetProfitElement.textContent = formatCurrency(totalNetProfit);
            if (totalNetProfit > 0) {
                totalNetProfitElement.className = 'value-shape positive';
            } else if (totalNetProfit < 0) {
                totalNetProfitElement.className = 'value-shape negative';
            } else {
                totalNetProfitElement.className = 'value-shape neutral';
            }
            
            showNotification('Filter tanggal berhasil diterapkan', 'success');
        }

        function applyCustomDateFilterPrint() {
            const startDate = document.getElementById('start-date-print').value;
            const endDate = document.getElementById('end-date-print').value;
            
            if (!startDate || !endDate) {
                showNotification('Pilih tanggal mulai dan tanggal selesai', 'error');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start > end) {
                showNotification('Tanggal mulai tidak boleh lebih besar dari tanggal selesai', 'error');
                return;
            }
            
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const printHistoryContainer = document.getElementById('print-history-container');
            
            if (history.length === 0) {
                printHistoryContainer.innerHTML = '<div class="empty-state"><i class="bi bi-printer"></i><p>Belum ada riwayat untuk dicetak</p></div>';
                return;
            }
            
            let filteredHistory = history.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= start && itemDate <= end;
            });
            
            let historyHTML = '';
            filteredHistory.forEach((item) => {
                const date = new Date(item.date).toLocaleString('id-ID');
                
                // Determine profit color class
                let profitClass = 'neutral';
                if (item.netProfit > 0) profitClass = 'positive';
                else if (item.netProfit < 0) profitClass = 'negative';
                
                // Find original index
                const originalIndex = history.findIndex(h => 
                    h.productName === item.productName && 
                    h.date === item.date
                );
                
                historyHTML += `
                    <div class="print-history-item" data-index="${originalIndex}" data-profit="${item.netProfit > 0 ? 'profit' : (item.netProfit < 0 ? 'loss' : 'neutral')}">
                        <input type="checkbox" class="print-checkbox" id="print-item-${originalIndex}" value="${originalIndex}">
                        <div class="product-info">
                            <div class="product-name">${item.productName}</div>
                            <div class="product-brand">${item.productBrand}</div>
                            <div class="history-date-shape">
                                <i class="bi bi-calendar-event"></i> ${date}
                            </div>
                        </div>
                        <div class="history-values">
                            <div class="value-shape ${profitClass} history-net-profit">${formatCurrency(item.netProfit)}</div>
                        </div>
                    </div>
                `;
            });
            
            if (historyHTML === '') {
                historyHTML = '<div class="empty-state"><i class="bi bi-printer"></i><p>Tidak ada riwayat untuk periode ini</p></div>';
            }
            
            printHistoryContainer.innerHTML = historyHTML;
            showNotification('Filter tanggal berhasil diterapkan', 'success');
        }

        function selectAllItems() {
            const checkboxes = document.querySelectorAll('.print-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            showNotification('Semua item telah dipilih', 'success');
        }

        function clearSelection() {
            const checkboxes = document.querySelectorAll('.print-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            showNotification('Semua pilihan telah dihapus', 'info');
        }

        function printSelectedItems() {
            const selectedCheckboxes = document.querySelectorAll('.print-checkbox:checked');
            
            if (selectedCheckboxes.length === 0) {
                showNotification('Pilih minimal satu item untuk dicetak', 'error');
                return;
            }
            
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const selectedItems = [];
            
            selectedCheckboxes.forEach(checkbox => {
                const index = parseInt(checkbox.value);
                if (history[index]) {
                    selectedItems.push(history[index]);
                }
            });
            
            // Get company profile
            const companyProfile = JSON.parse(localStorage.getItem('companyProfile') || '{}');
            
            // Create print content
            let printContent = `
                <html>
                <head>
                    <title>Laporan Keuangan</title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
                    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
                        
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        
                        body { 
                            font-family: 'Inter', sans-serif;
                            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                            color: #2c3e50;
                            padding: 0;
                            margin: 0;
                            line-height: 1.6;
                        }
                        
                        .report-container {
                            max-width: 900px;
                            margin: 0 auto;
                            padding: 40px 20px;
                        }
                        
                        .company-header {
                            text-align: center;
                            margin-bottom: 40px;
                            padding-bottom: 30px;
                            border-bottom: 2px solid #dee2e6;
                        }
                        
                        .company-logo {
                            width: 120px;
                            height: 120px;
                            margin: 0 auto 20px;
                            border-radius: 10px;
                            overflow: hidden;
                            background-color: white;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                        }
                        
                        .company-logo img {
                            max-width: 100%;
                            max-height: 100%;
                            object-fit: contain;
                        }
                        
                        .company-logo i {
                            font-size: 3rem;
                            color: #dee2e6;
                        }
                        
                        .company-name {
                            font-size: 28px;
                            font-weight: 700;
                            color: var(--primary-color);
                            margin: 0 0 5px;
                        }
                        
                        .company-tagline {
                            font-size: 16px;
                            color: #6c757d;
                            margin: 0 0 15px;
                            font-style: italic;
                        }
                        
                        .company-info {
                            display: flex;
                            justify-content: center;
                            flex-wrap: wrap;
                            gap: 15px;
                            margin-bottom: 10px;
                        }
                        
                        .company-info-item {
                            display: flex;
                            align-items: center;
                            font-size: 14px;
                            color: #495057;
                        }
                        
                        .company-info-item i {
                            margin-right: 5px;
                            color: var(--primary-color);
                        }
                        
                        .company-social {
                            display: flex;
                            justify-content: center;
                            gap: 10px;
                            margin-top: 10px;
                        }
                        
                        .company-social a {
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            width: 30px;
                            height: 30px;
                            border-radius: 50%;
                            background-color: #f8f9fa;
                            color: var(--primary-color);
                            text-decoration: none;
                        }
                        
                        .report-header {
                            text-align: center;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 2px solid #dee2e6;
                        }
                        
                        .report-title {
                            font-size: 28px;
                            font-weight: 700;
                            color: var(--primary-color);
                            margin: 0 0 10px;
                        }
                        
                        .report-subtitle {
                            font-size: 16px;
                            color: #6c757d;
                            margin: 0;
                        }
                        
                        .animated-date-badge {
                            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                            color: white;
                            border-radius: 30px;
                            padding: 0.5rem 1rem;
                            font-size: 0.9rem;
                            font-weight: 600;
                            display: inline-flex;
                            align-items: center;
                            box-shadow: 0 4px 10px rgba(255, 126, 0, 0.3);
                            position: relative;
                            overflow: hidden;
                            z-index: 1;
                            animation: float 3s ease-in-out infinite;
                        }
                        
                        .animated-date-badge::before {
                            content: '';
                            position: absolute;
                            top: -50%;
                            left: -50%;
                            width: 200%;
                            height: 200%;
                            background: linear-gradient(
                                to bottom right,
                                rgba(255, 255, 255, 0.3),
                                rgba(255, 255, 255, 0.1)
                            );
                            transform: rotate(45deg);
                            z-index: -1;
                            animation: shine 3s infinite;
                        }
                        
                        .animated-date-badge i {
                            margin-right: 0.5rem;
                            font-size: 1rem;
                            animation: pulse-icon 2s infinite;
                        }
                        
                        .items-container {
                            margin-bottom: 40px;
                        }
                        
                        .section-title {
                            font-size: 20px;
                            font-weight: 600;
                            color: #2c3e50;
                            margin: 30px 0 20px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }
                        
                        .section-title i {
                            color: var(--primary-color);
                        }
                        
                        .single-product-table {
                            width: 100%;
                            border-collapse: separate;
                            border-spacing: 0;
                            border-radius: 15px;
                            overflow: hidden;
                            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                            margin-bottom: 2rem;
                        }
                        
                        .single-product-table thead {
                            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
                            color: white;
                        }
                        
                        .single-product-table th {
                            padding: 15px;
                            text-align: left;
                            font-weight: 600;
                            position: relative;
                        }
                        
                        .single-product-table th:not(:last-child)::after {
                            content: '';
                            position: absolute;
                            right: 0;
                            top: 20%;
                            height: 60%;
                            width: 1px;
                            background-color: rgba(255, 255, 255, 0.3);
                        }
                        
                        .single-product-table tbody tr {
                            transition: all 0.3s ease;
                        }
                        
                        .single-product-table tbody tr:nth-child(even) {
                            background-color: #fff9f5;
                        }
                        
                        .single-product-table tbody tr:nth-child(odd) {
                            background-color: white;
                        }
                        
                        .single-product-table tbody tr:hover {
                            background-color: #fff4e6;
                            transform: scale(1.01);
                            box-shadow: 0 3px 10px rgba(255, 126, 0, 0.1);
                        }
                        
                        .single-product-table td {
                            padding: 15px;
                            border-bottom: 1px solid #f0f0f0;
                        }
                        
                        .single-product-table tbody tr:last-child td {
                            border-bottom: none;
                        }
                        
                        .single-product-table .value-shape {
                            display: inline-block;
                            padding: 0.3rem 0.8rem;
                            border-radius: 20px;
                            font-weight: 600;
                            font-size: 0.9rem;
                            transition: all 0.3s ease;
                        }
                        
                        .single-product-table .value-shape:hover {
                            transform: scale(1.05);
                        }
                        
                        .summary {
                            background: linear-gradient(135deg, rgba(10, 135, 84, 0.1) 0%, rgba(10, 135, 84, 0.05) 100%);
                            border-radius: 16px;
                            padding: 25px;
                            border-left: 4px solid var(--success-color);
                            margin-top: 30px;
                        }
                        
                        .summary-title {
                            font-size: 22px;
                            font-weight: 700;
                            color: #2c3e50;
                            margin-bottom: 20px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                        }
                        
                        .summary-title i {
                            color: var(--success-color);
                        }
                        
                        .summary-row {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 12px 0;
                            border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
                        }
                        
                        .summary-row:last-child {
                            border-bottom: none;
                            font-size: 18px;
                            font-weight: 700;
                            margin-top: 15px;
                            padding-top: 15px;
                            border-top: 2px solid rgba(0, 0, 0, 0.1);
                        }
                        
                        .summary-label {
                            font-weight: 500;
                            color: #495057;
                        }
                        
                        .summary-value {
                            font-weight: 600;
                        }
                        
                        .footer {
                            text-align: center;
                            margin-top: 50px;
                            padding-top: 20px;
                            border-top: 1px solid #dee2e6;
                            font-size: 12px;
                            color: #6c757d;
                        }
                        
                        .footer p {
                            margin: 5px 0;
                        }
                        
                        .watermark {
                            position: fixed;
                            bottom: 20px;
                            right: 20px;
                            opacity: 0.1;
                            font-size: 14px;
                            color: #2c3e50;
                            transform: rotate(-15deg);
                        }
                        
                        @keyframes float {
                            0%, 100% {
                                transform: translateY(0);
                            }
                            50% {
                                transform: translateY(-5px);
                            }
                        }
                        
                        @keyframes shine {
                            0% {
                                transform: translateX(-100%) translateY(-100%) rotate(45deg);
                            }
                            100% {
                                transform: translateX(100%) translateY(100%) rotate(45deg);
                            }
                        }
                        
                        @keyframes pulse-icon {
                            0%, 100% {
                                transform: scale(1);
                            }
                            50% {
                                transform: scale(1.2);
                            }
                        }
                        
                        @media print {
                            body {
                                background: white;
                                padding: 0;
                            }
                            
                            .report-container {
                                padding: 30px 20px;
                                max-width: 100%;
                            }
                            
                            .single-product-table {
                                box-shadow: none;
                                border: 1px solid #dee2e6;
                            }
                            
                            .watermark {
                                display: none;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="report-container">
                        ${companyProfile.name || companyProfile.tagline ? `
                        <div class="company-header">
                            ${companyProfile.logo ? `
                            <div class="company-logo">
                                <img src="${companyProfile.logo}" alt="${companyProfile.name || 'Logo Perusahaan'}">
                            </div>
                            ` : ''}
                            ${companyProfile.name ? `<h1 class="company-name">${companyProfile.name}</h1>` : ''}
                            ${companyProfile.tagline ? `<p class="company-tagline">${companyProfile.tagline}</p>` : ''}
                            
                            <div class="company-info">
                                ${companyProfile.established ? `
                                <div class="company-info-item">
                                    <i class="bi bi-calendar-event"></i>
                                    <span>Berdiri: ${companyProfile.established}</span>
                                </div>
                                ` : ''}
                                ${companyProfile.entity ? `
                                <div class="company-info-item">
                                    <i class="bi bi-building"></i>
                                    <span>${companyProfile.entity}</span>
                                </div>
                                ` : ''}
                                ${companyProfile.phone ? `
                                <div class="company-info-item">
                                    <i class="bi bi-telephone"></i>
                                    <span>${companyProfile.phone}</span>
                                </div>
                                ` : ''}
                                ${companyProfile.email ? `
                                <div class="company-info-item">
                                    <i class="bi bi-envelope"></i>
                                    <span>${companyProfile.email}</span>
                                </div>
                                ` : ''}
                                ${companyProfile.website ? `
                                <div class="company-info-item">
                                    <i class="bi bi-globe"></i>
                                    <span>${companyProfile.website}</span>
                                </div>
                                ` : ''}
                            </div>
                            
                            ${(companyProfile.instagram || companyProfile.facebook || companyProfile.tiktok || 
                              companyProfile.twitter || companyProfile.youtube || companyProfile.linkedin) ? `
                            <div class="company-social">
                                ${companyProfile.instagram ? `<a href="${companyProfile.instagram.startsWith('http') ? companyProfile.instagram : 'https://instagram.com/' + companyProfile.instagram}" target="_blank"><i class="bi bi-instagram"></i></a>` : ''}
                                ${companyProfile.facebook ? `<a href="${companyProfile.facebook.startsWith('http') ? companyProfile.facebook : 'https://facebook.com/' + companyProfile.facebook}" target="_blank"><i class="bi bi-facebook"></i></a>` : ''}
                                ${companyProfile.tiktok ? `<a href="${companyProfile.tiktok.startsWith('http') ? companyProfile.tiktok : 'https://tiktok.com/@' + companyProfile.tiktok}" target="_blank"><i class="bi bi-tiktok"></i></a>` : ''}
                                ${companyProfile.twitter ? `<a href="${companyProfile.twitter.startsWith('http') ? companyProfile.twitter : 'https://twitter.com/' + companyProfile.twitter}" target="_blank"><i class="bi bi-twitter"></i></a>` : ''}
                                ${companyProfile.youtube ? `<a href="${companyProfile.youtube.startsWith('http') ? companyProfile.youtube : 'https://youtube.com/' + companyProfile.youtube}" target="_blank"><i class="bi bi-youtube"></i></a>` : ''}
                                ${companyProfile.linkedin ? `<a href="${companyProfile.linkedin.startsWith('http') ? companyProfile.linkedin : 'https://linkedin.com/company/' + companyProfile.linkedin}" target="_blank"><i class="bi bi-linkedin"></i></a>` : ''}
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}
                        
                        <div class="report-header">
                            <h2 class="report-title">LAPORAN KEUANGAN</h2>
                            <p class="report-subtitle">Penghitung Keuangan</p>
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 30px;">
                            <div class="animated-date-badge">
                                <i class="bi bi-calendar-event"></i> 
                                ${new Date().toLocaleString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                            </div>
                        </div>
                        
                        <div class="items-container">
                            <h3 class="section-title">
                                <i class="bi bi-list-ul"></i>
                                DAFTAR PRODUK
                            </h3>
            `;
            
            // Add each selected item as a separate table
            selectedItems.forEach((item, index) => {
                const date = new Date(item.date).toLocaleString('id-ID');
                
                // Determine profit color class
                let grossProfitClass = 'neutral';
                if (item.grossProfit > 0) grossProfitClass = 'positive';
                else if (item.grossProfit < 0) grossProfitClass = 'negative';
                
                let netProfitClass = 'neutral';
                if (item.netProfit > 0) netProfitClass = 'positive';
                else if (item.netProfit < 0) netProfitClass = 'negative';
                
                printContent += `
                            <table class="single-product-table">
                                <thead>
                                    <tr>
                                        <th colspan="2">${item.productName} - ${item.productBrand}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td width="40%">Tanggal</td>
                                        <td>${date}</td>
                                    </tr>
                                    <tr>
                                        <td>Bruto</td>
                                        <td>${formatCurrency(item.bruto)}</td>
                                    </tr>
                                    <tr>
                                        <td>HPP</td>
                                        <td>${formatCurrency(item.hpp)}</td>
                                    </tr>
                                    <tr>
                                        <td>Laba Kotor</td>
                                        <td><span class="value-shape ${grossProfitClass}">${formatCurrency(item.grossProfit)}</span></td>
                                    </tr>
                                    <tr>
                                        <td>Total Pajak</td>
                                        <td>${formatCurrency(item.totalTax)}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Laba Bersih</strong></td>
                                        <td><span class="value-shape ${netProfitClass}">${formatCurrency(item.netProfit)}</span></td>
                                    </tr>
                                </tbody>
                            </table>
                `;
            });
            
            // Add summary
            const totalBruto = selectedItems.reduce((sum, item) => sum + parseFloat(item.bruto), 0);
            const totalHpp = selectedItems.reduce((sum, item) => sum + parseFloat(item.hpp), 0);
            const totalGrossProfit = selectedItems.reduce((sum, item) => sum + item.grossProfit, 0);
            const totalTax = selectedItems.reduce((sum, item) => sum + item.totalTax, 0);
            const totalNetProfit = selectedItems.reduce((sum, item) => sum + item.netProfit, 0);
            
            // Determine total profit color class
            let totalNetProfitClass = 'neutral';
            if (totalNetProfit > 0) totalNetProfitClass = 'positive';
            else if (totalNetProfit < 0) totalNetProfitClass = 'negative';
            
            printContent += `
                        </div>
                        
                        <div class="summary">
                            <h3 class="summary-title">
                                <i class="bi bi-calculator"></i>
                                RINGKASAN LAPORAN
                            </h3>
                            <div class="summary-row">
                                <span class="summary-label">Total Bruto</span>
                                <span class="value-shape neutral">${formatCurrency(totalBruto)}</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Total HPP</span>
                                <span class="value-shape neutral">${formatCurrency(totalHpp)}</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Total Laba Kotor</span>
                                <span class="value-shape ${totalGrossProfit > 0 ? 'positive' : (totalGrossProfit < 0 ? 'negative' : 'neutral')}">${formatCurrency(totalGrossProfit)}</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Total Pajak</span>
                                <span class="value-shape neutral">${formatCurrency(totalTax)}</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">TOTAL LABA BERSIH</span>
                                <span class="value-shape ${totalNetProfitClass}">${formatCurrency(totalNetProfit)}</span>
                            </div>
                        </div>
                        
                        <div class="footer">
                            <p>Laporan ini dicetak melalui Aplikasi Penghitung Keuangan pada ${new Date().toLocaleString('id-ID')}</p>
                            <p>Jumlah item: ${selectedItems.length}</p>
                            <p>© ${new Date().getFullYear()} Penghitung Keuangan. Hak Cipta Dilindungi.</p>
                        </div>
                    </div>
                    
                    <div class="watermark">Penghitung Keuangan</div>
                </body>
                </html>
            `;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
            
            showNotification(`Laporan dengan ${selectedItems.length} item berhasil dicetak`, 'success');
        }

        function deleteHistoryItem(index) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const item = history[index];
            
            if (!item) return;
            
            // Add to deleted history
            let deletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');
            deletedHistory.unshift({
                ...item,
                deletedAt: new Date().toISOString()
            });
            
            // Keep only last 20 deleted items
            if (deletedHistory.length > 20) deletedHistory = deletedHistory.slice(0, 20);
            
            localStorage.setItem('deletedHistory', JSON.stringify(deletedHistory));
            
            // Remove from main history
            history.splice(index, 1);
            localStorage.setItem('calculationHistory', JSON.stringify(history));
            
            // Update displays
            updateHistoryDisplay();
            updateDeletedHistoryDisplay();
            updatePrintHistoryDisplay();
            updateReportSummary();
            
            showNotification('Item berhasil dihapus dan dipindahkan ke riwayat penghapusan', 'info');
        }

        function updateDeletedHistoryDisplay() {
            const deletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');
            const deletedHistoryContainer = document.getElementById('deleted-history-container');
            
            if (deletedHistory.length === 0) {
                deletedHistoryContainer.innerHTML = '<div class="empty-state"><i class="bi bi-recycle"></i><p>Belum ada riwayat penghapusan</p></div>';
                return;
            }
            
            let historyHTML = '';
            deletedHistory.forEach((item, index) => {
                const date = new Date(item.deletedAt).toLocaleString('id-ID');
                const originalDate = new Date(item.date).toLocaleString('id-ID');
                
                // Determine profit color class
                let profitClass = 'neutral';
                if (item.netProfit > 0) profitClass = 'positive';
                else if (item.netProfit < 0) profitClass = 'negative';
                
                historyHTML += `
                    <div class="history-item deleted-history-item" data-index="${index}" data-name="${item.productName.toLowerCase()}" data-brand="${item.productBrand.toLowerCase()}" data-profit="${item.netProfit > 0 ? 'profit' : (item.netProfit < 0 ? 'loss' : 'neutral')}">
                        <div class="history-actions">
                            <button class="restore-btn" onclick="restoreHistoryItem(${index})">
                                <i class="bi bi-arrow-clockwise"></i> Pulihkan
                            </button>
                            <button class="permanent-delete-btn" onclick="permanentDeleteHistoryItem(${index})">
                                <i class="bi bi-trash"></i> Hapus Permanen
                            </button>
                        </div>
                        <div class="history-header">
                            <div class="history-date-badge">
                                <i class="bi bi-trash"></i> ${date} (dihapus)
                            </div>
                        </div>
                        <div class="history-content">
                            <div class="product-info">
                                <div class="product-name">${item.productName}</div>
                                <div class="product-brand"><i class="bi bi-tag"></i> ${item.productBrand}</div>
                                <div class="history-date" style="font-size: 0.8rem; opacity: 0.7;">Asli: ${originalDate}</div>
                            </div>
                            <div class="history-profit">
                                <div class="history-profit-label">Laba Bersih</div>
                                <div class="value-shape ${profitClass} history-net-profit">${formatCurrency(item.netProfit)}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            deletedHistoryContainer.innerHTML = historyHTML;
        }

        function restoreHistoryItem(index) {
            const deletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');
            const item = deletedHistory[index];
            
            if (!item) return;
            
            // Remove from deleted history
            deletedHistory.splice(index, 1);
            localStorage.setItem('deletedHistory', JSON.stringify(deletedHistory));
            
            // Add back to main history (remove deletedAt property)
            const { deletedAt, ...restoredItem } = item;
            
            let history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            history.unshift(restoredItem);
            
            // Keep only last 50 calculations
            if (history.length > 50) history = history.slice(0, 50);
            
            localStorage.setItem('calculationHistory', JSON.stringify(history));
            
            // Update displays
            updateHistoryDisplay();
            updateDeletedHistoryDisplay();
            updatePrintHistoryDisplay();
            updateReportSummary();
            
            showNotification('Item berhasil dipulihkan', 'success');
        }

        function permanentDeleteHistoryItem(index) {
            const deletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');
            const item = deletedHistory[index];
            
            if (!item) return;
            
            if (confirm(`Apakah Anda yakin ingin menghapus "${item.productName}" secara permanen? Tindakan ini tidak dapat dibatalkan.`)) {
                // Remove from deleted history
                deletedHistory.splice(index, 1);
                localStorage.setItem('deletedHistory', JSON.stringify(deletedHistory));
                
                // Update display
                updateDeletedHistoryDisplay();
                
                showNotification(`"${item.productName}" berhasil dihapus permanen`, 'info');
            }
        }

        function clearHistory() {
            if (confirm('Apakah Anda yakin ingin menghapus semua riwayat perhitungan? Item yang dihapus akan dipindahkan ke riwayat penghapusan.')) {
                const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
                
                if (history.length === 0) {
                    showNotification('Tidak ada riwayat untuk dihapus', 'info');
                    return;
                }
                
                // Move all items to deleted history
                let deletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');
                
                history.forEach(item => {
                    deletedHistory.unshift({
                        ...item,
                        deletedAt: new Date().toISOString()
                    });
                });
                
                // Keep only last 20 deleted items
                if (deletedHistory.length > 20) deletedHistory = deletedHistory.slice(0, 20);
                
                localStorage.setItem('deletedHistory', JSON.stringify(deletedHistory));
                localStorage.setItem('calculationHistory', JSON.stringify([]));
                
                // Update displays
                updateHistoryDisplay();
                updateDeletedHistoryDisplay();
                updatePrintHistoryDisplay();
                updateReportSummary();
                
                showNotification(`Semua riwayat (${history.length} item) berhasil dihapus`, 'success');
            }
        }

        function loadHistoryItem(index) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const item = history[index];
            
            if (!item) return;
            
            // Load values into form
            document.getElementById('product-name').value = item.productName;
            document.getElementById('product-brand').value = item.productBrand === '-' ? '' : item.productBrand;
            document.getElementById('bruto').value = item.bruto;
            document.getElementById('hpp').value = item.hpp;
            
            // Switch to input tab
            const inputTab = new bootstrap.Tab(document.getElementById('input-tab'));
            inputTab.show();
            
            showNotification('Riwayat berhasil dimuat', 'info');
        }

        function editHistoryItem(index) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const item = history[index];
            
            if (!item) return;
            
            // Store the index globally for saving later
            window.currentEditIndex = index;
            
            // Populate the edit form with current values
            document.getElementById('edit-product-name').value = item.productName;
            document.getElementById('edit-product-brand').value = item.productBrand;
            document.getElementById('edit-bruto').value = item.bruto;
            document.getElementById('edit-hpp').value = item.hpp;
            document.getElementById('edit-gross-profit').value = item.grossProfit;
            document.getElementById('edit-total-tax').value = item.totalTax;
            document.getElementById('edit-net-profit').value = item.netProfit;
            
            // Show the modal
            const modal = document.getElementById('edit-history-modal');
            modal.classList.add('show');
        }

        function closeEditHistoryModal() {
            const modal = document.getElementById('edit-history-modal');
            modal.classList.remove('show');
        }

        function saveEditedHistoryItem() {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const index = window.currentEditIndex;
            
            if (index === undefined || !history[index]) {
                showNotification('Terjadi kesalahan saat menyimpan perubahan', 'error');
                return;
            }
            
            // Get updated values from form
            const updatedItem = {
                ...history[index],
                productName: document.getElementById('edit-product-name').value,
                productBrand: document.getElementById('edit-product-brand').value,
                bruto: document.getElementById('edit-bruto').value,
                hpp: document.getElementById('edit-hpp').value,
                grossProfit: parseFloat(document.getElementById('edit-gross-profit').value) || 0,
                totalTax: parseFloat(document.getElementById('edit-total-tax').value) || 0,
                netProfit: parseFloat(document.getElementById('edit-net-profit').value) || 0
            };
            
            // Update the history item
            history[index] = updatedItem;
            
            // Save to localStorage
            localStorage.setItem('calculationHistory', JSON.stringify(history));
            
            // Update displays
            updateHistoryDisplay();
            updatePrintHistoryDisplay();
            updateReportSummary();
            
            // Close modal
            closeEditHistoryModal();
            
            showNotification('Riwayat berhasil diperbarui', 'success');
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            
            // Update icon
            const icon = document.querySelector('.dark-mode-toggle i');
            if (document.body.classList.contains('dark-mode')) {
                icon.className = 'bi bi-sun-fill';
            } else {
                icon.className = 'bi bi-moon-stars-fill';
            }
        }

        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            });
            
            // Create icon based on type
            let icon = 'bi-info-circle-fill';
            if (type === 'success') icon = 'bi-check-circle-fill';
            if (type === 'error') icon = 'bi-exclamation-circle-fill';
            if (type === 'warning') icon = 'bi-exclamation-triangle-fill';
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `<i class="bi ${icon}"></i> ${message}`;
            
            document.body.appendChild(notification);
            
            // Trigger animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Fungsi untuk mengurutkan riwayat penghapusan
        function sortDeletedHistory(sortType) {
            // Update active state in dropdown
            const dropdownItems = document.querySelectorAll('#deletedSortDropdown + .dropdown-menu .dropdown-item');
            dropdownItems.forEach(item => {
                if (item.getAttribute('data-sort') === sortType) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Get current time filter
            const activeTimeItem = document.querySelector('#deletedTimeFilterDropdown + .dropdown-menu .dropdown-item.active');
            const timeFilter = activeTimeItem ? activeTimeItem.getAttribute('data-time') : 'all';
            
            // Check if custom date filter is active
            const customDateContainer = document.getElementById('custom-date-container-deleted');
            if (customDateContainer.style.display === 'block') {
                const startDate = document.getElementById('start-date-deleted').value;
                const endDate = document.getElementById('end-date-deleted').value;
                
                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    applyDeletedHistoryFiltersWithCustomDate(start, end, sortType);
                } else {
                    applyDeletedHistoryFilters(timeFilter, sortType);
                }
            } else {
                applyDeletedHistoryFilters(timeFilter, sortFilter);
            }
        }

        // Fungsi untuk memfilter riwayat penghapusan berdasarkan waktu
        function filterDeletedHistoryByTime(timeFilter) {
            // Update active state in dropdown
            const dropdownItems = document.querySelectorAll('#deletedTimeFilterDropdown + .dropdown-menu .dropdown-item');
            dropdownItems.forEach(item => {
                if (item.getAttribute('data-time') === timeFilter) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Show/hide custom date container based on filter
            const customDateContainer = document.getElementById('custom-date-container-deleted');
            if (timeFilter === 'custom') {
                customDateContainer.style.display = 'block';
                return; // Don't apply filter yet, wait for user to select dates
            } else {
                customDateContainer.style.display = 'none';
            }
            
            // Get current sort filter
            const activeSortItem = document.querySelector('#deletedSortDropdown + .dropdown-menu .dropdown-item.active');
            const sortFilter = activeSortItem ? activeSortItem.getAttribute('data-sort') : 'all';
            
            // Apply both time and sort filters
            applyDeletedHistoryFilters(timeFilter, sortFilter);
        }

        // Fungsi untuk memfilter riwayat penghapusan berdasarkan laba
        function filterDeletedHistoryByProfit(profitFilter) {
            // Update active state in dropdown
            const dropdownItems = document.querySelectorAll('#deletedProfitFilterDropdown + .dropdown-menu .dropdown-item');
            dropdownItems.forEach(item => {
                if (item.getAttribute('data-profit') === profitFilter) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Get current time filter
            const activeTimeItem = document.querySelector('#deletedTimeFilterDropdown + .dropdown-menu .dropdown-item.active');
            const timeFilter = activeTimeItem ? activeTimeItem.getAttribute('data-time') : 'all';
            
            // Check if custom date filter is active
            const customDateContainer = document.getElementById('custom-date-container-deleted');
            if (customDateContainer.style.display === 'block') {
                const startDate = document.getElementById('start-date-deleted').value;
                const endDate = document.getElementById('end-date-deleted').value;
                
                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    applyDeletedHistoryFiltersWithCustomDate(start, end, profitFilter);
                } else {
                    applyDeletedHistoryFilters(timeFilter, profitFilter);
                }
            } else {
                applyDeletedHistoryFilters(timeFilter, profitFilter);
            }
        }

        // Fungsi untuk menerapkan filter pada riwayat penghapusan
        function applyDeletedHistoryFilters(timeFilter, sortFilter) {
            const deletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');
            let filteredHistory = [...deletedHistory];
            const now = new Date();
            
            // Apply time filter
            switch(timeFilter) {
                case '30':
                    filteredHistory = deletedHistory.filter(item => {
                        const itemDate = new Date(item.deletedAt);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 30;
                    });
                    break;
                case '15':
                    filteredHistory = deletedHistory.filter(item => {
                        const itemDate = new Date(item.deletedAt);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 15;
                    });
                    break;
                case '7':
                    filteredHistory = deletedHistory.filter(item => {
                        const itemDate = new Date(item.deletedAt);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 7;
                    });
                    break;
                case '3':
                    filteredHistory = deletedHistory.filter(item => {
                        const itemDate = new Date(item.deletedAt);
                        const diffTime = Math.abs(now - itemDate);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 3;
                    });
                    break;
                case 'today':
                    filteredHistory = deletedHistory.filter(item => {
                        const itemDate = new Date(item.deletedAt);
                        return itemDate.toDateString() === now.toDateString();
                    });
                    break;
                case 'all':
                default:
                    // No time filter
                    break;
            }
            
            // Apply sort filter
            applyDeletedSortFilter(filteredHistory, sortFilter);
        }

        // Fungsi untuk menerapkan filter dengan tanggal kustom pada riwayat penghapusan
        function applyDeletedHistoryFiltersWithCustomDate(startDate, endDate, sortFilter) {
            const deletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');
            let filteredHistory = deletedHistory.filter(item => {
                const itemDate = new Date(item.deletedAt);
                return itemDate >= startDate && itemDate <= endDate;
            });
            
            // Apply sort filter
            applyDeletedSortFilter(filteredHistory, sortFilter);
        }

        // Fungsi untuk menerapkan filter sortir pada riwayat penghapusan
        function applyDeletedSortFilter(historyData, sortFilter) {
            let sortedHistory = [...historyData];
            
            // Sort based on selected type
            switch(sortFilter) {
                case 'az':
                    sortedHistory.sort((a, b) => a.productName.localeCompare(b.productName));
                    break;
                case 'za':
                    sortedHistory.sort((a, b) => b.productName.localeCompare(a.productName));
                    break;
                case 'profit':
                    sortedHistory.sort((a, b) => {
                        // Sort by profit (descending) but only include profitable items
                        const aProfit = a.netProfit > 0 ? a.netProfit : -Infinity;
                        const bProfit = b.netProfit > 0 ? b.netProfit : -Infinity;
                        return bProfit - aProfit;
                    });
                    break;
                case 'loss':
                    sortedHistory.sort((a, b) => {
                        // Sort by loss (ascending) but only include loss items
                        const aLoss = a.netProfit < 0 ? Math.abs(a.netProfit) : -Infinity;
                        const bLoss = b.netProfit < 0 ? Math.abs(b.netProfit) : -Infinity;
                        return bLoss - aLoss;
                    });
                    break;
                case 'all':
                default:
                    // Default sorting (most recent first)
                    sortedHistory.sort((a, b) => new Date(b.deletedAt) - new Date(a.deletedAt));
                    break;
            }
            
            // Update display with sorted and filtered history
            updateDeletedHistoryDisplayWithSortedData(sortedHistory);
        }

        // Fungsi untuk memperbarui tampilan riwayat penghapusan dengan data yang diurutkan
        function updateDeletedHistoryDisplayWithSortedData(sortedHistory) {
            const deletedHistoryContainer = document.getElementById('deleted-history-container');
            
            if (sortedHistory.length === 0) {
                deletedHistoryContainer.innerHTML = '<div class="empty-state"><i class="bi bi-recycle"></i><p>Belum ada riwayat penghapusan</p></div>';
                return;
            }
            
            let historyHTML = '';
            sortedHistory.forEach((item, index) => {
                // Find original index for edit/delete operations
                const originalDeletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');
                const originalIndex = originalDeletedHistory.findIndex(h => 
                    h.productName === item.productName && 
                    h.deletedAt === item.deletedAt
                );
                
                const date = new Date(item.deletedAt).toLocaleString('id-ID');
                const originalDate = new Date(item.date).toLocaleString('id-ID');
                
                // Determine profit color class
                let profitClass = 'neutral';
                if (item.netProfit > 0) profitClass = 'positive';
                else if (item.netProfit < 0) profitClass = 'negative';
                
                historyHTML += `
                    <div class="history-item deleted-history-item" data-index="${originalIndex}" data-name="${item.productName.toLowerCase()}" data-brand="${item.productBrand.toLowerCase()}" data-profit="${item.netProfit > 0 ? 'profit' : (item.netProfit < 0 ? 'loss' : 'neutral')}">
                        <div class="history-actions">
                            <button class="restore-btn" onclick="restoreHistoryItem(${originalIndex})">
                                <i class="bi bi-arrow-clockwise"></i> Pulihkan
                            </button>
                            <button class="permanent-delete-btn" onclick="permanentDeleteHistoryItem(${originalIndex})">
                                <i class="bi bi-trash"></i> Hapus Permanen
                            </button>
                        </div>
                        <div class="history-header">
                            <div class="history-date-badge">
                                <i class="bi bi-trash"></i> ${date} (dihapus)
                            </div>
                        </div>
                        <div class="history-content">
                            <div class="product-info">
                                <div class="product-name">${item.productName}</div>
                                <div class="product-brand"><i class="bi bi-tag"></i> ${item.productBrand}</div>
                                <div class="history-date" style="font-size: 0.8rem; opacity: 0.7;">Asli: ${originalDate}</div>
                            </div>
                            <div class="history-profit">
                                <div class="history-profit-label">Laba Bersih</div>
                                <div class="value-shape ${profitClass} history-net-profit">${formatCurrency(item.netProfit)}</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            deletedHistoryContainer.innerHTML = historyHTML;
        }

        // Fungsi untuk menerapkan filter tanggal kustom pada riwayat penghapusan
        function applyCustomDateFilterDeleted() {
            const startDate = document.getElementById('start-date-deleted').value;
            const endDate = document.getElementById('end-date-deleted').value;
            
            if (!startDate || !endDate) {
                showNotification('Pilih tanggal mulai dan tanggal selesai', 'error');
                return;
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start > end) {
                showNotification('Tanggal mulai tidak boleh lebih besar dari tanggal selesai', 'error');
                return;
            }
            
            // Get current sort filter
            const activeSortItem = document.querySelector('#deletedSortDropdown + .dropdown-menu .dropdown-item.active');
            const sortFilter = activeSortItem ? activeSortItem.getAttribute('data-sort') : 'all';
            
            // Apply both custom date and sort filters
            applyDeletedHistoryFiltersWithCustomDate(start, end, sortFilter);
            
            showNotification('Filter tanggal berhasil diterapkan', 'success');
        }

        // Fungsi untuk menampilkan semua item riwayat penghapusan
        function displayAllDeletedHistoryItems() {
            const historyItems = document.querySelectorAll('#deleted-history-container .history-item');
            historyItems.forEach(item => {
                item.style.display = 'flex';
            });
        }

        // Fungsi untuk mencari produk pada riwayat penghapusan
        function searchDeletedProducts(searchTerm) {
            const historyItems = document.querySelectorAll('#deleted-history-container .history-item');
            
            if (searchTerm.trim() === '') {
                // If search term is empty, show all items
                displayAllDeletedHistoryItems();
                return;
            }
            
            const lowerCaseSearchTerm = searchTerm.toLowerCase();
            
            historyItems.forEach(item => {
                const productName = item.getAttribute('data-name');
                
                if (productName.includes(lowerCaseSearchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Fungsi untuk mencari merek pada riwayat penghapusan
        function searchDeletedBrands(searchTerm) {
            const historyItems = document.querySelectorAll('#deleted-history-container .history-item');
            
            if (searchTerm.trim() === '') {
                // If search term is empty, show all items
                displayAllDeletedHistoryItems();
                return;
            }
            
            const lowerCaseSearchTerm = searchTerm.toLowerCase();
            
            historyItems.forEach(item => {
                const brandName = item.getAttribute('data-brand');
                
                if (brandName.includes(lowerCaseSearchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Fungsi untuk menghapus semua riwayat penghapusan
        function clearDeletedHistory() {
            if (confirm('Apakah Anda yakin ingin menghapus semua riwayat penghapusan secara permanen? Tindakan ini tidak dapat dibatalkan.')) {
                const deletedHistory = JSON.parse(localStorage.getItem('deletedHistory') || '[]');
                
                if (deletedHistory.length === 0) {
                    showNotification('Tidak ada riwayat penghapusan untuk dihapus', 'info');
                    return;
                }
                
                // Clear all deleted history
                localStorage.setItem('deletedHistory', JSON.stringify([]));
                
                // Update display
                updateDeletedHistoryDisplay();
                
                showNotification(`Semua riwayat penghapusan (${deletedHistory.length} item) berhasil dihapus permanen`, 'success');
            }
        }

        // Company Profile Functions
        function setupCompanyProfilePreview() {
            // Setup input event listeners for company profile fields
            const fields = [
                'company-name', 'company-tagline', 'company-established', 'company-entity',
                'company-address', 'company-branches', 'company-phone', 'company-email',
                'company-website', 'company-whatsapp', 'company-instagram', 'company-facebook',
                'company-tiktok', 'company-twitter', 'company-youtube', 'company-linkedin'
            ];
            
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', updateCompanyProfilePreview);
                }
            });
        }

        function updateCompanyProfilePreview() {
            const name = document.getElementById('company-name').value;
            const tagline = document.getElementById('company-tagline').value;
            const established = document.getElementById('company-established').value;
            const entity = document.getElementById('company-entity').value;
            const address = document.getElementById('company-address').value;
            const phone = document.getElementById('company-phone').value;
            const email = document.getElementById('company-email').value;
            const website = document.getElementById('company-website').value;
            
            // Update preview elements
            document.getElementById('preview-name').textContent = name || 'Nama Perusahaan';
            document.getElementById('preview-tagline').textContent = tagline || 'Tagline Perusahaan';
            
            // Show/hide elements based on whether they have values
            document.getElementById('preview-established-container').style.display = established ? 'flex' : 'none';
            document.getElementById('preview-entity-container').style.display = entity ? 'flex' : 'none';
            document.getElementById('preview-address-container').style.display = address ? 'flex' : 'none';
            document.getElementById('preview-phone-container').style.display = phone ? 'flex' : 'none';
            document.getElementById('preview-email-container').style.display = email ? 'flex' : 'none';
            document.getElementById('preview-website-container').style.display = website ? 'flex' : 'none';
            
            // Update values
            document.getElementById('preview-established').textContent = `Berdiri: ${established}`;
            document.getElementById('preview-entity').textContent = entity;
            document.getElementById('preview-address').textContent = address;
            document.getElementById('preview-phone').textContent = phone;
            document.getElementById('preview-email').textContent = email;
            document.getElementById('preview-website').textContent = website;
            
            // Update social media
            const socialMedia = document.getElementById('preview-social-media');
            socialMedia.innerHTML = '';
            
            const socialFields = [
                { id: 'company-instagram', icon: 'bi-instagram', label: 'Instagram' },
                { id: 'company-facebook', icon: 'bi-facebook', label: 'Facebook' },
                { id: 'company-tiktok', icon: 'bi-tiktok', label: 'TikTok' },
                { id: 'company-twitter', icon: 'bi-twitter', label: 'Twitter' },
                { id: 'company-youtube', icon: 'bi-youtube', label: 'YouTube' },
                { id: 'company-linkedin', icon: 'bi-linkedin', label: 'LinkedIn' }
            ];
            
            socialFields.forEach(field => {
                const value = document.getElementById(field.id).value;
                if (value) {
                    const socialItem = document.createElement('div');
                    socialItem.className = 'preview-social-media-item';
                    socialItem.innerHTML = `<i class="bi ${field.icon}"></i> ${field.label}`;
                    socialMedia.appendChild(socialItem);
                }
            });
        }

        function previewCompanyLogo(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const preview = document.getElementById('company-logo-preview');
                    preview.innerHTML = `<img src="${e.target.result}" alt="Company Logo">`;
                    
                    // Also update the preview in the company profile preview
                    const logoPreview = document.getElementById('preview-logo');
                    logoPreview.innerHTML = `<img src="${e.target.result}" alt="Company Logo">`;
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        function removeCompanyLogo() {
            const preview = document.getElementById('company-logo-preview');
            preview.innerHTML = `
                <div class="company-logo-placeholder">
                    <i class="bi bi-image"></i>
                    <p>Logo Perusahaan</p>
                </div>
            `;
            
            // Also update the preview in the company profile preview
            const logoPreview = document.getElementById('preview-logo');
            logoPreview.innerHTML = '<i class="bi bi-building"></i>';
            
            // Clear the file input
            document.getElementById('company-logo').value = '';
        }

        function saveCompanyProfile() {
            const companyProfile = {
                name: document.getElementById('company-name').value,
                tagline: document.getElementById('company-tagline').value,
                established: document.getElementById('company-established').value,
                entity: document.getElementById('company-entity').value,
                address: document.getElementById('company-address').value,
                branches: document.getElementById('company-branches').value,
                phone: document.getElementById('company-phone').value,
                email: document.getElementById('company-email').value,
                website: document.getElementById('company-website').value,
                whatsapp: document.getElementById('company-whatsapp').value,
                instagram: document.getElementById('company-instagram').value,
                facebook: document.getElementById('company-facebook').value,
                tiktok: document.getElementById('company-tiktok').value,
                twitter: document.getElementById('company-twitter').value,
                youtube: document.getElementById('company-youtube').value,
                linkedin: document.getElementById('company-linkedin').value
            };
            
            // Get logo if exists
            const logoPreview = document.querySelector('#company-logo-preview img');
            if (logoPreview) {
                companyProfile.logo = logoPreview.src;
            }
            
            // Save to localStorage
            localStorage.setItem('companyProfile', JSON.stringify(companyProfile));
            
            showNotification('Profil perusahaan berhasil disimpan', 'success');
        }

        function loadCompanyProfile() {
            const companyProfile = JSON.parse(localStorage.getItem('companyProfile') || '{}');
            
            // Load values into form
            document.getElementById('company-name').value = companyProfile.name || '';
            document.getElementById('company-tagline').value = companyProfile.tagline || '';
            document.getElementById('company-established').value = companyProfile.established || '';
            document.getElementById('company-entity').value = companyProfile.entity || '';
            document.getElementById('company-address').value = companyProfile.address || '';
            document.getElementById('company-branches').value = companyProfile.branches || '';
            document.getElementById('company-phone').value = companyProfile.phone || '';
            document.getElementById('company-email').value = companyProfile.email || '';
            document.getElementById('company-website').value = companyProfile.website || '';
            document.getElementById('company-whatsapp').value = companyProfile.whatsapp || '';
            document.getElementById('company-instagram').value = companyProfile.instagram || '';
            document.getElementById('company-facebook').value = companyProfile.facebook || '';
            document.getElementById('company-tiktok').value = companyProfile.tiktok || '';
            document.getElementById('company-twitter').value = companyProfile.twitter || '';
            document.getElementById('company-youtube').value = companyProfile.youtube || '';
            document.getElementById('company-linkedin').value = companyProfile.linkedin || '';
            
            // Load logo if exists
            if (companyProfile.logo) {
                const preview = document.getElementById('company-logo-preview');
                preview.innerHTML = `<img src="${companyProfile.logo}" alt="Company Logo">`;
                
                // Also update the preview in the company profile preview
                const logoPreview = document.getElementById('preview-logo');
                logoPreview.innerHTML = `<img src="${companyProfile.logo}" alt="Company Logo">`;
            }
            
            // Update preview
            updateCompanyProfilePreview();
        }

        function resetCompanyProfile() {
            if (confirm('Apakah Anda yakin ingin mereset semua data profil perusahaan?')) {
                // Clear localStorage
                localStorage.removeItem('companyProfile');
                
                // Reset form
                document.getElementById('company-name').value = '';
                document.getElementById('company-tagline').value = '';
                document.getElementById('company-established').value = '';
                document.getElementById('company-entity').value = '';
                document.getElementById('company-address').value = '';
                document.getElementById('company-branches').value = '';
                document.getElementById('company-phone').value = '';
                document.getElementById('company-email').value = '';
                document.getElementById('company-website').value = '';
                document.getElementById('company-whatsapp').value = '';
                document.getElementById('company-instagram').value = '';
                document.getElementById('company-facebook').value = '';
                document.getElementById('company-tiktok').value = '';
                document.getElementById('company-twitter').value = '';
                document.getElementById('company-youtube').value = '';
                document.getElementById('company-linkedin').value = '';
                
                // Reset logo
                removeCompanyLogo();
                
                // Update preview
                updateCompanyProfilePreview();
                
                showNotification('Profil perusahaan berhasil direset', 'success');
            }
        }
    </script>
</body>
</html>